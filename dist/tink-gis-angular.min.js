/*! tink-gis-angular v1.0.0 */
"use strict";function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}!function(){var module;try{module=angular.module("tink.gis")}catch(e){module=angular.module("tink.gis",["tink.navigation","tink.accordion","tink.tinkApi","ui.sortable","tink.modal","angular.filter","tink.pagination","tink.tooltip"])}module.constant("appConfig",{templateUrl:"/digipolis.stadinkaart.webui",apiUrl:"/digipolis.stadinkaart.api/",enableDebug:!0,enableLog:!0}),module.directive("preventDefault",function(){return{link:function(scope,element,attrs){element.on("click",function(event){event.preventDefault(),event.stopPropagation()}),element.on("dblclick",function(event){event.stopPropagation()}),element.on("mousemove",function(event){event.stopPropagation()})}}}),JXON.config({attrPrefix:"",autoDate:!1});var mapObject=(function(){L.AwesomeMarkers.Icon.prototype.options.prefix="fa"}(),function(){var crsLambert=new L.Proj.CRS("EPSG:31370","+proj=lcc +lat_1=51.16666723333334 +lat_2=49.83333389999999 +lat_0=90 +lon_0=4.367486666666666 +x_0=150000.013 +y_0=5400088.438 +ellps=intl +towgs84=-99.1,53.3,-112.5,0.419,-0.83,1.885,-1.0 +units=m +no_defs",{origin:[-35872700,41422700],resolutions:[66.1459656252646,52.91677250021167,39.687579375158755,26.458386250105836,13.229193125052918,6.614596562526459,5.291677250021167,3.9687579375158752,3.3072982812632294,2.6458386250105836,1.9843789687579376,1.3229193125052918,.6614596562526459,.5291677250021167,.39687579375158755,.33072982812632296,.26458386250105836,.19843789687579377,.13229193125052918,.06614596562526459,.026458386250105836]}),map=L.map("map",{crs:crsLambert,zoomControl:!1,drawControl:!1}).setView([51.2192159,4.4028818],5);map.doubleClickZoom.disable();var drawnItems=L.featureGroup().addTo(map);return map.on("draw:created",function(event){var layer=event.layer;drawnItems.addLayer(layer)}),map.on("draw:drawstart",function(event){}),map.clearDrawings=function(){console.log("clearingDrawings"),console.log(drawnItems),drawnItems.clearLayers()},map});module.factory("map",mapObject)}();var ThemeStatus={UNMODIFIED:0,NEW:1,UPDATED:2,DELETED:3},LayerType={LAYER:0,GROUP:1},ActiveInteractieButton={IDENTIFY:"identify",SELECT:"select",METEN:"meten",WATISHIER:"watishier"},Gis={Arcgissql:"",BaseUrl:"https://geoint.antwerpen.be/",GeometryUrl:"https://geoint.antwerpen.be/arcgissql/rest/services/Utilities/Geometry/GeometryServer/buffer"};Gis.Arcgissql=Gis.BaseUrl+"arcgissql/rest/";var DrawingOption={NIETS:"",AFSTAND:"afstand",OPPERVLAKTE:"oppervlakte",LIJN:"lijn",VIERKANT:"vierkant",POLYGON:"polygon"},ThemeType={ESRI:"esri",WMS:"wms"},Style={DEFAULT:{fillOpacity:0,color:"blue",weight:5},HIGHLIGHT:{weight:7,color:"red",fillOpacity:.5},BUFFER:{fillColor:"#00cc00",color:"#00cc00",weight:1,opacity:.9,fillOpacity:.3}},Scales=[25e4,2e5,15e4,1e5,5e4,25e3,2e4,15e3,12500,1e4,7500,5e3,2500,2e3,1500,1250,1e3,750,500,250,100];!function(module){var module;try{module=angular.module("tink.gis")}catch(e){module=angular.module("tink.gis",["tink.accordion","tink.tinkApi","ui.sortable","tink.modal","angular.filter"])}module.controller("geoPuntController",["$scope","ThemeCreater","$q","MapService","MapData","GISService","LayerManagementService","WMSService","$window","$http","GeopuntService",function($scope,ThemeCreater,$q,MapService,MapData,GISService,LayerManagementService,WMSService,$window,$http,GeopuntService){$scope.searchIsUrl=!1,$scope.pagingCount=null,$scope.numberofrecordsmatched=0,LayerManagementService.EnabledThemes.length=0,LayerManagementService.AvailableThemes.length=0,LayerManagementService.EnabledThemes=angular.copy(MapData.Themes),$scope.availableThemes=[];(function(){$scope.searchTerm="",$scope.searchIsUrl=!1})();$scope.searchChanged=function(){null!=$scope.searchTerm&&""!=$scope.searchTerm&&$scope.searchTerm.length>2?($scope.clearPreview(),$scope.searchTerm.startsWith("http")?$scope.searchIsUrl=!0:($scope.searchIsUrl=!1,$scope.QueryGeoPunt($scope.searchTerm,1))):($scope.availableThemes.length=0,$scope.numberofrecordsmatched=0)},$scope.QueryGeoPunt=function(searchTerm,page){var prom=GeopuntService.getMetaData(searchTerm,5*(page-1)+1,5);prom.then(function(metadata){$scope.availableThemes=metadata.results,$scope.currentrecord=metadata.currentrecord,$scope.nextrecord=metadata.nextrecord,$scope.numberofrecordsmatched=metadata.numberofrecordsmatched},function(reason){console.log(reason)})},$scope.pageChanged=function(page,recordsAPage){$scope.QueryGeoPunt($scope.searchTerm,page)},$scope.laadUrl=function(){$scope.searchTerm=$scope.searchTerm.trim().replace("?",""),createWMS($scope.searchTerm)},$scope.geopuntThemeChanged=function(theme){var questionmarkPos=theme.Url.trim().indexOf("?"),url=theme.Url.trim().substring(0,questionmarkPos);createWMS(url)};var createWMS=function(url){var wms=MapData.Themes.find(function(x){return x.CleanUrl==url});if(void 0==wms){var getwms=WMSService.GetThemeData(url);getwms.success(function(data,status,headers,config){var wmstheme=ThemeCreater.createWMSThemeFromJSON(data,url);$scope.previewTheme(wmstheme)}).error(function(data,status,headers,config){$window.alert("error")})}else $scope.previewTheme(wms)};$scope.selectedTheme=null,$scope.copySelectedTheme=null,$scope.previewTheme=function(theme){$scope.selectedTheme=theme,$scope.copySelectedTheme=angular.copy(theme)},$scope.clearPreview=function(){$scope.selectedTheme=null,$scope.copySelectedTheme=null},$scope.AddOrUpdateTheme=function(){LayerManagementService.AddOrUpdateTheme($scope.selectedTheme,$scope.copySelectedTheme),$scope.clearPreview()}}])}(),function(module){var module;try{module=angular.module("tink.gis")}catch(e){module=angular.module("tink.gis",["tink.accordion","tink.tinkApi","ui.sortable","tink.modal","angular.filter"])}module.controller("LayerManagerController",["$scope","$modalInstance","LayerManagementService",function($scope,$modalInstance,LayerManagementService){$scope.active="solr",$scope.ok=function(){$modalInstance.$close()},$scope.cancel=function(){$modalInstance.$dismiss("cancel is pressed")}}])}(),function(module){var module;try{module=angular.module("tink.gis")}catch(e){module=angular.module("tink.gis",["tink.accordion","tink.tinkApi","ui.sortable","tink.modal","angular.filter"])}module.controller("layersManagementController",["$scope","MapData","ThemeService","LayerManagementService",function($scope,MapData,ThemeService,LayerManagementService){$scope.pagingCount=null,$scope.numberofrecordsmatched=0,$scope.availableThemes=MapData.Themes,$scope.allThemes=[];(function(){$scope.searchTerm=""})();$scope.searchChanged=function(){},$scope.pageChanged=function(page,recordsAPage){var startItem=(page-1)*recordsAPage;$scope.availableThemes=$scope.allThemes.slice(startItem,startItem+recordsAPage)},$scope.selectedTheme=null,$scope.copySelectedTheme=null,$scope.previewTheme=function(theme){console.log("themeChanged"),console.log(theme);var alreadyExistingTheme=MapData.Themes.find(function(x){return x.CleanUrl===theme.CleanUrl});alreadyExistingTheme&&(theme=alreadyExistingTheme),$scope.selectedTheme=theme,$scope.copySelectedTheme=angular.copy(theme)},$scope.clearPreview=function(){$scope.selectedTheme=null,$scope.copySelectedTheme=null},$scope.ThemeChanged=function(theme){$scope.previewTheme(theme),$scope.selected=theme,$scope.isActive=function(theme){return $scope.selected===theme}},$scope.AddOrUpdateTheme=function(){LayerManagementService.AddOrUpdateTheme($scope.selectedTheme,$scope.copySelectedTheme),$scope.clearPreview()}}])}(),function(module){var module=angular.module("tink.gis"),theController=module.controller("managementLayerController",function($scope){var vm=this;vm.layer=$scope.layer,$scope.showLayer=!1,console.log(vm.layer.AllLayers)});theController.$inject=[]}(),function(module){var module;try{module=angular.module("tink.gis")}catch(e){module=angular.module("tink.gis",["tink.accordion","tink.tinkApi","ui.sortable","tink.modal","angular.filter"])}module.controller("previewLayerController",["$scope",function($scope){$scope.delTheme=function(){$scope.theme.AllLayers.forEach(function(lay){lay.enabled=!1}),$scope.addorupdatefunc()}}])}(),function(module){var module;try{module=angular.module("tink.gis")}catch(e){module=angular.module("tink.gis",["tink.accordion","tink.tinkApi","ui.sortable","tink.modal","angular.filter"])}module.controller("solrGISController",["$scope","ThemeCreater","$q","MapService","MapData","GISService","LayerManagementService","WMSService","$window","$http","GeopuntService","ThemeService",function($scope,ThemeCreater,$q,MapService,MapData,GISService,LayerManagementService,WMSService,$window,$http,GeopuntService,ThemeService){$scope.pagingCount=null,$scope.numberofrecordsmatched=0,LayerManagementService.AvailableThemes.length=0,$scope.availableThemes=[],$scope.allThemes=[];(function(){$scope.searchTerm=""})();$scope.searchChanged=function(){null!=$scope.searchTerm&&""!=$scope.searchTerm&&$scope.searchTerm.length>2?($scope.clearPreview(),$scope.QueryGISSOLR($scope.searchTerm,1)):($scope.availableThemes.length=0,$scope.numberofrecordsmatched=0)},$scope.QueryGISSOLR=function(searchterm,page){var prom=GISService.QuerySOLRGIS(searchterm,5*(page-1)+1,5);prom.then(function(data){$scope.currentPage=1;var allitems=data.facet_counts.facet_fields.parent,itemsMetData=data.grouped.parent.groups,themes=(allitems.length,[]);itemsMetData.forEach(function(itemMetData){switch(itemMetData.doclist.docs[0].type){case"Feature":var themeName=itemMetData.groupValue.split("/").slice(1,2).join("/"),layerId=itemMetData.groupValue.split("/")[2],layerName=itemMetData.doclist.docs[0].parentname,theme=themes.find(function(x){return x.name==themeName});if(!theme){var theme={layers:[],layersCount:0,name:themeName,cleanUrl:Gis.BaseUrl+"arcgissql/rest/services/P_Stad/"+themeName+"/MapServer",url:"services/P_Stad/"+themeName+"/MapServer"};themes.push(theme)}var layer=theme.layers.find(function(x){return x.id==layerId});layer?layer.featuresCount=itemMetData.doclist.numFound:(layer={naam:layerName,id:layerId,features:[],featuresCount:itemMetData.doclist.numFound,isMatch:!1},theme.layers.push(layer)),itemMetData.doclist.docs.forEach(function(item){var feature=item.titel.join(" ");layer.features.push(feature)});break;case"Layer":var themeName=itemMetData.groupValue.split("/")[1],theme=themes.find(function(x){return x.name==themeName});theme?theme.layersCount=itemMetData.doclist.numFound:(theme={layers:[],layersCount:itemMetData.doclist.numFound,name:themeName,cleanUrl:Gis.BaseUrl+"arcgissql/rest/services/P_Stad/"+themeName+"/MapServer",url:"services/P_Stad/"+themeName+"/MapServer"},themes.push(theme)),itemMetData.doclist.docs.forEach(function(item){var layer=theme.layers.find(function(x){return x.id==item.key});layer?layer.isMatch=!0:(layer={naam:item.titel[0],id:item.key,isMatch:!0,featuresCount:0,features:[]},theme.layers.push(layer))});break;default:console.log("UNKOWN TYPE:",item)}}),$scope.availableThemes=themes.slice(0,5),$scope.allThemes=themes,$scope.numberofrecordsmatched=themes.length,console.log(data)},function(reason){console.log(reason)})},$scope.pageChanged=function(page,recordsAPage){var startItem=(page-1)*recordsAPage;$scope.availableThemes=$scope.allThemes.slice(startItem,startItem+recordsAPage)},$scope.selectedTheme=null,$scope.copySelectedTheme=null,$scope.previewTheme=function(theme){console.log("themeChanged"),console.log(theme);var alreadyExistingTheme=MapData.Themes.find(function(x){return x.CleanUrl===theme.CleanUrl});alreadyExistingTheme&&(theme=alreadyExistingTheme),$scope.selectedTheme=theme,$scope.copySelectedTheme=angular.copy(theme)},$scope.clearPreview=function(){$scope.selectedTheme=null,$scope.copySelectedTheme=null},$scope.solrThemeChanged=function(theme){GISService.GetThemeData(theme.url).then(function(data,statuscode,functie,getdata){if(data.error)console.log("ERROR:",data.error);else{var convertedTheme=ThemeCreater.createARCGISThemeFromJson(data,theme);$scope.previewTheme(convertedTheme)}}),$scope.selected=theme,$scope.isActive=function(theme){return $scope.selected===theme}},$scope.AddOrUpdateTheme=function(){LayerManagementService.AddOrUpdateTheme($scope.selectedTheme,$scope.copySelectedTheme),$scope.clearPreview()},$scope.ok=function(){$modalInstance.$close()},$scope.cancel=function(){$modalInstance.$dismiss("cancel is pressed")}}])}(),function(module){module=angular.module("tink.gis"),module.directive("geoPunt",function(){return{replace:!0,scope:{layer:"="},templateUrl:"templates/layermanagement/geoPuntTemplate.html",controller:"geoPuntController",controllerAs:"geoPuntctrl"}})}(),function(module){module=angular.module("tink.gis"),module.directive("tinkManagementlayer",["RecursionHelper",function(RecursionHelper){return{replace:!1,scope:{layer:"="},templateUrl:"templates/layermanagement/managementLayerTemplate.html",controller:"managementLayerController",controllerAs:"lyrctrl",compile:function(element){return RecursionHelper.compile(element)}}}])}(),function(module){module=angular.module("tink.gis"),module.directive("layersManagement",function(){return{replace:!0,templateUrl:"templates/layermanagement/layersManagementTemplate.html",controller:"layersManagementController",controllerAs:"layersManagementctrl"}})}(),function(module){module=angular.module("tink.gis"),module.directive("previewLayer",function(){return{replace:!0,scope:{theme:"=",addorupdatefunc:"&"},templateUrl:"templates/layermanagement/previewLayerTemplate.html",controller:"previewLayerController",controllerAs:"previewctrl"}})}(),function(module){module=angular.module("tink.gis"),module.directive("solrGis",function(){return{replace:!0,scope:{layer:"="},templateUrl:"templates/layermanagement/solrGISTemplate.html",controller:"solrGISController",controllerAs:"solrGISctrl"}})}(),function(){var module=angular.module("tink.gis"),service=function($http,map,MapData,$rootScope,$q,helperService){var _service={};_service.getMetaData=function(){var searchterm=arguments.length<=0||void 0===arguments[0]?"water":arguments[0],startpos=arguments.length<=1||void 0===arguments[1]?1:arguments[1],recordsAPage=arguments.length<=2||void 0===arguments[2]?10:arguments[2],url="https://metadata.geopunt.be/zoekdienst/srv/dut/csw?service=CSW&version=2.0.2&SortBy=title&request=GetRecords&namespace=xmlns%28csw=http://www.opengis.net/cat/csw%29&resultType=results&outputSchema=http://www.opengis.net/cat/csw/2.0.2&outputFormat=application/xml&startPosition="+startpos+"&maxRecords="+recordsAPage+"&typeNames=csw:Record&elementSetName=full&constraintLanguage=CQL_TEXT&constraint_language_version=1.1.0&constraint=AnyText+LIKE+%27%25"+searchterm+"%25%27AND%20Type%20=%20%27service%27%20AND%20Servicetype%20=%27view%27",prom=$q.defer();return $http.get(helperService.CreateProxyUrl(url)).success(function(data,status,headers,config){if(data){data=helperService.UnwrapProxiedData(data);var returnjson=JXON.stringToJs(data),getResults=returnjson["csw:getrecordsresponse"]["csw:searchresults"],returnObject={};if(returnObject.searchTerm=searchterm,returnObject.currentrecord=startpos,returnObject.recordsAPage=recordsAPage,returnObject.nextrecord=getResults.nextrecord,returnObject.numberofrecordsmatched=getResults.numberofrecordsmatched,returnObject.numberofrecordsreturned=getResults.numberofrecordsreturned,returnObject.results=[],0!=returnObject.numberofrecordsmatched)if(1==returnObject.numberofrecordsmatched){var processedTheme=procesTheme(getResults["csw:record"]);returnObject.results.push(processedTheme)}else getResults["csw:record"].forEach(function(record){var processedTheme=procesTheme(record);returnObject.results.push(processedTheme)});prom.resolve(returnObject)}else prom.reject(null),console.log("EMPTY RESULT")}).error(function(data,status,headers,config){prom.reject(null),console.log("ERROR!",data,status,headers,config)}),prom.promise};var procesTheme=function(record){if(record["dc:uri"]instanceof Array==0){var tmpdata=record["dc:uri"];record["dc:uri"]=[],record["dc:uri"].push(tmpdata)}var tmptheme={};tmptheme.Added=!1,tmptheme.Naam=record["dc:title"];var wmsinfo=record["dc:uri"].find(function(x){return"WMS"==x.protocol||"OGC:WMS"==x.protocol});return wmsinfo?(tmptheme.Url=wmsinfo.keyValue,tmptheme.Type=ThemeType.WMS):tmptheme.Type="DONTKNOW",tmptheme.TMPMETADATA=record,tmptheme};return _service};module.factory("GeopuntService",["$http","map","MapData","$rootScope","$q","HelperService",service])}(),function(){var module=angular.module("tink.gis"),service=function(MapData,$http,$q,GISService,ThemeCreater,ThemeService){var _service={};return _service.EnabledThemes=[],_service.AvailableThemes=[],_service.AddOrUpdateTheme=function(selectedTheme,copySelectedTheme){console.log("AddOrUpdateTheme");for(var allChecked=!0,noneChecked=!0,hasAChange=!1,x=0;x<copySelectedTheme.AllLayers.length;x++){var copyLayer=copySelectedTheme.AllLayers[x],realLayer=selectedTheme.AllLayers[x];realLayer.enabled!=copyLayer.enabled&&(hasAChange=!0),realLayer.enabled=copyLayer.enabled,copyLayer.enabled===!1?allChecked=!1:noneChecked=!1}var alreadyAdded=void 0!=MapData.Themes.find(function(x){return x.CleanUrl===selectedTheme.CleanUrl});alreadyAdded?(hasAChange?selectedTheme.status=ThemeStatus.UPDATED:selectedTheme.status=ThemeStatus.UNMODIFIED,noneChecked&&(selectedTheme.status=ThemeStatus.DELETED)):selectedTheme.status=ThemeStatus.NEW,allChecked&&selectedTheme!=ThemeStatus.DELETED&&(selectedTheme.Added=!0),allChecked||noneChecked||selectedTheme==ThemeStatus.DELETED||(selectedTheme.Added=null),selectedTheme==ThemeStatus.DELETED&&(selectedTheme.Added=!1),ThemeService.AddAndUpdateThemes([selectedTheme])},_service};module.$inject=["MapData","$http","$q","GISService","ThemeCreater","ThemeService"],module.factory("LayerManagementService",service)}(),function(module){try{var module=angular.module("tink.gis")}catch(e){var module=angular.module("tink.gis",["tink.accordion","tink.tinkApi"])}module.controller("layerController",function($scope){var vm=this;vm.layer=$scope.layer})}(),function(module){module=angular.module("tink.gis");var theController=module.controller("layersController",function($scope,MapData,map,ThemeService,$modal){var vm=this;vm.themes=MapData.Themes,vm.selectedLayers=[],vm.sortableOptions={stop:function(e,ui){MapData.SetZIndexes()}},$scope.$watch(function(){return MapData.Themes},function(newVal,oldVal){MapData.SetZIndexes(newVal)}),vm.updatethemevisibility=function(theme){ThemeService.UpdateThemeVisibleLayers(theme)},vm.Lagenbeheer=function(){var addLayerInstance=$modal.open({templateUrl:"templates/layermanagement/layerManagerTemplate.html",controller:"LayerManagerController",resolve:{backdrop:!1,keyboard:!0}});addLayerInstance.result.then(function(){},function(obj){console.log("Modal dismissed at: "+new Date)})}});theController.$inject=["MapData","map","ThemeService","$modal"]}(),function(module){module=angular.module("tink.gis");var theController=module.controller("mapController",function($scope,ExternService,BaseLayersService,MapService,MapData,map,MapEvents,DrawService,HelperService,GISService,PopupService,$interval){var vm=this;(function(){if(window.location.href.startsWith("http://localhost:9000/")){var externproj=JSON.parse('{"naam":"Velo en fietspad!!","extent":{"_northEast":{"lat":"51.2336102032025","lng":"4.41993402409611"},"_southWest":{"lat":"51.1802290498612","lng":"4.38998297870121"}},"guid":"bfc88ea3-8581-4204-bdbc-b5f54f46050d","extentString":"51.2336102032025,4.41993402409611,51.1802290498612,4.38998297870121","isKaart":true,"uniqId":3,"creatorId":6,"creator":null,"createDate":"2016-08-22T10:55:15.525994","updaterId":6,"updater":null,"lastUpdated":"2016-08-22T10:55:15.525994","themes":[{"cleanUrl":"services/P_Stad/Mobiliteit/MapServer","naam":"Mobiliteit","type":"esri","visible":true,"layers":[{"id":"9","name":"fietspad","visible":true},{"id":"6","name":"velo","visible":true},{"id":"0","name":"Fiets en voetganger","visible":true}]}],"isReadOnly":false}');ExternService.Import(externproj),PopupService.Info("Velo en fietspad loaded because you are in DEV.",null,function(){alert("onclicktestje")})}})();vm.ZoekenOpLocatie=!0,vm.activeInteractieKnop=MapData.ActiveInteractieKnop,vm.SelectableLayers=function(){return MapData.VisibleLayers},vm.selectedLayer=function(){return MapData.SelectedLayer},vm.drawingType=MapData.DrawingType,vm.showMetenControls=!1,vm.showDrawControls=!1,vm.zoekLoc="";var suggestionfunc=function(item){var output="<div>"+item.name;return item.attribute1value&&(output+="<p>"+item.attribute1name+": "+item.attribute1value+"</p>"),item.attribute2value&&(output+="<p>"+item.attribute2name+": "+item.attribute2value+"</p>"),item.layer&&(output+="<p>Laag: "+item.layer+"</p>"),output+="</div>"},isCharDigit=function(n){return" "!=n&&n>-1},features=[];L.control.typeahead({minLength:3,highlight:!0,classNames:{open:"is-open",empty:"is-empty"}},{async:!0,limit:99,display:"name",displayKey:"name",source:function(query,syncResults,asyncResults){if(query.replace(/[^0-9]/g,"").length<6){var splitquery=query.split(" "),numbers=splitquery.filter(function(x){return isCharDigit(x[0])}),notnumbers=splitquery.filter(function(x){return!isCharDigit(x[0])});if(1==numbers.length&&1==notnumbers.length){var huisnummer=numbers[0],straatnaam=notnumbers.join(" ");console.log(straatnaam,huisnummer),GISService.QueryCrab(straatnaam,huisnummer).then(function(data){console.log(data),features=data.features.map(function(feature){var obj={};return obj.straatnaam=feature.attributes.STRAATNM,obj.huisnummer=feature.attributes.HUISNR,obj.busnummer=feature.attributes.BUSNR,obj.id=feature.attributes.OBJECTID,obj.x=feature.geometry.x,obj.y=feature.geometry.y,obj.name=(obj.straatnaam+" "+obj.huisnummer+" "+obj.busnummer).trim(),obj}).slice(0,10),console.log(features),asyncResults(features)})}else GISService.QuerySOLRLocatie(query.trim()).then(function(data){var arr=data.response.docs;asyncResults(arr)})}else syncResults([]),vm.zoekXY(query)},templates:{suggestion:suggestionfunc,notFound:['<div class="empty-message"><b>Geen match gevonden</b></div>'],empty:['<div class="empty-message"><b>Zoek naar straten, POI en districten</b></div>']}},{placeholder:"Geef een X,Y / locatie of POI in.","typeahead:select":function(ev,suggestion){if(MapData.CleanWatIsHier(),MapData.CleanTempFeatures(),suggestion.layer)switch(suggestion.layer.toLowerCase()){case"postzone":MapData.QueryForTempFeatures(20,"ObjectID="+suggestion.key);break;case"district":MapData.QueryForTempFeatures(21,"ObjectID="+suggestion.key);break;default:var cors={x:suggestion.x,y:suggestion.y},xyWGS84=HelperService.ConvertLambert72ToWSG84(cors);setViewAndPutDot(xyWGS84)}else{var cors={x:suggestion.x,y:suggestion.y},xyWGS84=HelperService.ConvertLambert72ToWSG84(cors);setViewAndPutDot(xyWGS84)}}}).addTo(map),vm.interactieButtonChanged=function(ActiveButton){switch(MapData.CleanMap(),MapData.ActiveInteractieKnop=ActiveButton,vm.activeInteractieKnop=ActiveButton,vm.showMetenControls=!1,vm.showDrawControls=!1,ActiveButton){case ActiveInteractieButton.SELECT:vm.showDrawControls=!0,vm.selectpunt();break;case ActiveInteractieButton.METEN:vm.showMetenControls=!0,vm.drawingButtonChanged(DrawingOption.AFSTAND)}},vm.zoekLaag=function(search){MapData.CleanMap(),MapService.Find(search)};var setViewAndPutDot=function(loc){MapData.PanToPoint(loc),MapData.CreateDot(loc)};vm.zoekXY=function(search){search=search.trim();var WGS84Check=HelperService.getWGS84CordsFromString(search);if(WGS84Check.hasCordinates)setViewAndPutDot(WGS84Check);else{var lambertCheck=HelperService.getLambartCordsFromString(search);if(lambertCheck.hasCordinates){var xyWGS84=HelperService.ConvertLambert72ToWSG84({x:lambertCheck.x,y:lambertCheck.y});setViewAndPutDot(xyWGS84)}else console.log("NIET GEVONDEN")}},vm.drawingButtonChanged=function(drawOption){MapData.CleanMap(),MapData.DrawingType=drawOption,vm.drawingType=drawOption,DrawService.StartDraw(drawOption)},vm.Loading=0,vm.MaxLoading=0,$scope.$watch(function(){return MapData.Loading},function(newVal,oldVal){console.log("MapData.Loading at start",MapData.Loading),vm.Loading=newVal,0==oldVal&&(vm.MaxLoading=newVal),vm.MaxLoading<oldVal&&(vm.MaxLoading=oldVal),0==newVal&&(vm.MaxLoading=0),console.log("MapLoading val: "+newVal+"/"+vm.MaxLoading),console.log("MapData.Loading at the end",MapData.Loading)}),vm.selectpunt=function(){MapData.CleanMap(),MapData.DrawingType=DrawingOption.NIETS,vm.drawingType=DrawingOption.NIETS},vm.layerChange=function(){MapData.CleanMap(),MapData.SelectedLayer=vm.selectedLayer},vm.zoomIn=function(){map.zoomIn()},vm.zoomOut=function(){map.zoomOut()},vm.fullExtent=function(){map.setView(new L.LatLng(51.2192159,4.4028818),16)},vm.IsBaseMap1=!0,vm.toonBaseMap1=function(){vm.IsBaseMap1=!0,map.removeLayer(BaseLayersService.basemap2),map.addLayer(BaseLayersService.basemap1)},vm.toonBaseMap2=function(){vm.IsBaseMap1=!1,map.removeLayer(BaseLayersService.basemap1),map.addLayer(BaseLayersService.basemap2)},vm.baseMap1Naam=function(){return BaseLayersService.basemap1Naam},vm.baseMap2Naam=function(){return BaseLayersService.basemap2Naam},vm.cancelPrint=function(){var html=$("html");html.hasClass("print")&&html.removeClass("print"),vm.portrait()},vm.print=function(){window.print()},vm.printStyle="portrait";var cssPagedMedia=function(){var style=document.createElement("style");return document.head.appendChild(style),function(rule){style.id="tempstyle",style.innerHTML=rule}}();cssPagedMedia.size=function(oriantation){cssPagedMedia("@page {size: A4 "+oriantation+"}")},vm.setPrintStyle=function(oriantation){vm.printStyle=oriantation,cssPagedMedia.size(oriantation)},vm.setPrintStyle("portrait"),vm.portrait=function(){var html=$("html");vm.setPrintStyle("portrait"),html.hasClass("landscape")&&html.removeClass("landscape"),map.invalidateSize(!1)},vm.landscape=function(){var html=$("html");vm.setPrintStyle("landscape"),html.hasClass("landscape")||html.addClass("landscape"),map.invalidateSize(!1)},vm.ZoekenInLagen=function(){vm.ZoekenOpLocatie=!1,$(".twitter-typeahead").addClass("hide-element")},vm.fnZoekenOpLocatie=function(){return vm.ZoekenOpLocatie=!0,$(".twitter-typeahead").hasClass("hide-element")?void $(".twitter-typeahead").removeClass("hide-element"):vm.ZoekenOpLocatie},vm.gpstracking=!1;var gpstracktimer=null;vm.zoomToGps=function(){vm.gpstracking=!vm.gpstracking,0==vm.gpstracking?($interval.cancel(gpstracktimer),MapEvents.ClearGPS()):(map.locate({setView:!0,maxZoom:16}),gpstracktimer=$interval(function(){map.locate({setView:!1}),console.log("gps refresh")},5e3))}});theController.$inject=["BaseLayersService","ExternService","MapService","MapData","map","MapEvents","DrawService","HelperService","GISService","PopupService","$interval"]}(),function(module){module=angular.module("tink.gis"),module.controller("themeController",["$scope","MapService","ThemeService",function($scope,MapService,ThemeService){var vm=this;console.log("Theme geladen"),vm.theme=$scope.theme,vm.hidedelete=$scope.hidedelete,vm.chkChanged=function(){ThemeService.UpdateThemeVisibleLayers(vm.theme)},vm.deleteTheme=function(){swal({title:"Verwijderen?",text:"U staat op het punt om "+vm.theme.Naam+" te verwijderen.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Verwijder",closeOnConfirm:!0},function(){ThemeService.DeleteTheme(vm.theme),$scope.$apply()}),console.log(vm.theme)}}])}(),function(module){angular.module("tink.gis").directive("indeterminateCheckbox",[function(){return{scope:!0,require:"?ngModel",link:function(scope,element,attrs,modelCtrl){function watchChildrenListWithProperty(){return thelist.map(function(x){return x[property]})}var childList=attrs.childList,property=attrs.property;element.bind("change",function(){scope.$apply(function(){var isChecked=element.prop("checked");angular.forEach(scope.$eval(childList),function(child){child[property]=isChecked})})});var thelist=scope.$eval(childList);thelist&&scope.$watch(watchChildrenListWithProperty,function(newValue,oldValue){if(newValue!==oldValue){var hasChecked=!1,hasUnchecked=!1;angular.forEach(newValue,function(child){child?hasChecked=!0:hasUnchecked=!0}),hasChecked&&hasUnchecked?(element.prop("checked",!0),element.prop("indeterminate",!0),modelCtrl&&modelCtrl.$setViewValue(!0)):(element.prop("checked",hasChecked),element.prop("indeterminate",!1),modelCtrl&&modelCtrl.$setViewValue(hasChecked))}},!0)}}}])}(),function(module){module=angular.module("tink.gis"),module.directive("tinkLayer",["RecursionHelper",function(RecursionHelper){return{replace:!1,scope:{layer:"=",layercheckboxchange:"&"},templateUrl:"templates/other/layerTemplate.html",controller:"layerController",controllerAs:"lyrctrl",compile:function(element){return RecursionHelper.compile(element)}}}])}(),function(module){module=angular.module("tink.gis"),module.directive("tinkLayers",function(){return{replace:!0,templateUrl:"templates/other/layersTemplate.html",controller:"layersController",controllerAs:"lyrsctrl"}})}(),function(){var module;try{module=angular.module("tink.gis")}catch(e){module=angular.module("tink.gis",["tink.accordion","tink.tinkApi","ui.sortable","tink.modal","angular.filter","tink.pagination"])}module.directive("tinkMap",function(){return{replace:!0,templateUrl:"templates/other/mapTemplate.html",controller:"mapController",controllerAs:"mapctrl"}})}(),function(module){module=angular.module("tink.gis"),module.directive("tinkTheme",function(){return{replace:!0,scope:{theme:"=",layercheckboxchange:"&",hidedelete:"="},templateUrl:"templates/other/themeTemplate.html",controller:"themeController",controllerAs:"thmctrl"}})}(),function(){var module=angular.module("tink.gis"),service=function($http,HelperService,$q){var _service={};_service.ReverseGeocode=function(event){var lambert72Cords=HelperService.ConvertWSG84ToLambert72(event.latlng),loc=lambert72Cords.x+","+lambert72Cords.y,urlloc=encodeURIComponent(loc),url=Gis.BaseUrl+"arcgissql/rest/services/COMLOC_CRAB_NAVTEQ/GeocodeServer/reverseGeocode?location="+urlloc+"&distance=50&outSR=&f=json",prom=$http.get(url);return prom.success(function(data,status,headers,config){}).error(function(data,status,headers,config){console.log("ERROR!",status,headers,data)}),prom},_service.QueryCrab=function(straatnaam,huisnummer){var prom=$q.defer();return $http.get("https://geoint.antwerpen.be/arcgissql/rest/services/P_Stad/CRAB_adresposities/MapServer/0/query?where=GEMEENTE%3D%27Antwerpen%27+and+STRAATNM+%3D%27"+straatnaam+" %27+and+HUISNR+like+%27"+huisnummer+"%25%27&text=&objectIds=&time=&geometry=&geometryType=esriGeometryEnvelope&inSR=&spatialRel=esriSpatialRelIntersects&relationParam=&outFields=*&returnGeometry=true&maxAllowableOffset=&geometryPrecision=&outSR=&returnIdsOnly=false&returnCountOnly=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&returnZ=false&returnM=false&gdbVersion=&returnDistinctValues=false&f=pjson").success(function(data,status,headers,config){
prom.resolve(data)}).error(function(data,status,headers,config){prom.reject(null),console.log("ERROR!",data,status,headers,config)}),prom.promise},_service.QuerySOLRGIS=function(search){var prom=$q.defer(),url="https://esb-app1-o.antwerpen.be/v1/giszoek/solr/search?q=*"+search+"*&wt=json&indent=true&facet=true&rows=999&facet.field=parent&group=true&group.field=parent&group.limit=5&solrtype=gis";return $http.get(url).success(function(data,status,headers,config){prom.resolve(data)}).error(function(data,status,headers,config){prom.reject(null),console.log("ERROR!",data,status,headers,config)}),prom.promise},_service.QuerySOLRLocatie=function(search){var prom=$q.defer(),url="https://esb-app1-o.antwerpen.be/v1/giszoek/solr/search?q=*"+search+"*&wt=json&indent=true&rows=50&solrtype=gislocaties&dismax=true&bq=exactName:DISTRICT^20000.0&bq=layer:WEGENREGISTER_STRAATAS_XY^20000.0";return $http.get(url).success(function(data,status,headers,config){prom.resolve(data)}).error(function(data,status,headers,config){prom.reject(null),console.log("ERROR!",data,status,headers,config)}),prom.promise};var completeUrl=function(url){var baseurl=Gis.BaseUrl+"arcgissql/rest/";return url.contains("arcgissql/rest/")||(url=baseurl+url),url};return _service.GetThemeData=function(mapserver){var prom=$q.defer(),url=completeUrl(mapserver)+"?f=pjson";return $http.get(url).success(function(data,status,headers,config){prom.resolve(data)}).error(function(data,status,headers,config){prom.reject(null),console.log("ERROR!",data,status,headers,config)}),prom.promise},_service.GetThemeLayerData=function(cleanurl){var prom=$q.defer(),url=completeUrl(cleanurl)+"/layers?f=pjson";return $http.get(url).success(function(data,status,headers,config){prom.resolve(data)}).error(function(data,status,headers,config){prom.reject(null),console.log("ERROR!",data,status,headers,config)}),prom.promise},_service.GetLegendData=function(cleanurl){var prom=$q.defer(),url=completeUrl(cleanurl)+"/legend?f=pjson";return $http.get(url).success(function(data,status,headers,config){prom.resolve(data)}).error(function(data,status,headers,config){prom.reject(null),console.log("ERROR!",data,status,headers,config)}),prom.promise},_service.GetAditionalLayerInfo=function(theme){var promLegend=_service.GetLegendData(theme.CleanUrl);promLegend.then(function(data){theme.AllLayers.forEach(function(layer){var layerid=layer.id,layerInfo=data.layers.find(function(x){return x.layerId==layerid});layer.legend=[],layerInfo&&(layer.legend=layerInfo.legend,layer.legend.forEach(function(legenditem){legenditem.fullurl=theme.CleanUrl+"/"+layerInfo.layerId+"/images/"+legenditem.url}))})});var promLayerData=_service.GetThemeLayerData(theme.CleanUrl);promLayerData.then(function(data){theme.AllLayers.forEach(function(layer){var layerid=layer.id,layerInfo=data.layers.find(function(x){return x.id==layerid});layer.displayField=layerInfo.displayField,layer.fields=layerInfo.fields})})},_service};module.$inject=["$http","HelperService","$q"],module.factory("GISService",service)}(),function(){var module=angular.module("tink.gis"),service=function($http,MapService,MapData){var _service={};_service.Buffer=function(location,distance,selectedlayer){MapData.CleanMap();var geo=getGeo(location.geometry);delete geo.geometry.spatialReference,geo.geometries=geo.geometry,delete geo.geometry;var sergeo=serialize(geo),url=Gis.GeometryUrl,body="inSR=4326&outSR=4326&bufferSR=31370&distances="+100*distance+"&unit=109006&unionResults=true&geodesic=false&geometries=%7B"+sergeo+"%7D&f=json",prom=$http({method:"POST",url:url,data:body,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8;"}});return prom.success(function(response){var buffer=MapData.CreateBuffer(response);MapService.Query(buffer,selectedlayer)}),prom},_service.Doordruk=function(location){MapData.CleanMap(),console.log(location),MapService.Query(location)};var getGeo=function(geometry){var geoconverted={};return geometry instanceof L.LatLngBounds?(geoconverted.geometry=L.esri.Util.boundsToExtent(geometry),geoconverted.geometryType="esriGeometryEnvelope",geoconverted):(geometry.getLatLng&&(geometry=geometry.getLatLng()),geometry instanceof L.LatLng&&(geometry={type:"Point",coordinates:[geometry.lng,geometry.lat]}),geometry instanceof L.GeoJSON&&(geometry=geometry.getLayers()[0].feature.geometry,geoconverted.geometry=L.esri.Util.geojsonToArcGIS(geometry),geoconverted.geometryType=L.esri.Util.geojsonTypeToArcGIS(geometry.type)),geometry.toGeoJSON&&(geometry=geometry.toGeoJSON()),"Feature"===geometry.type?geometry=geometry.geometry:(geoconverted.geometry=L.esri.Util.geojsonToArcGIS(geometry),geoconverted.geometryType=L.esri.Util.geojsonTypeToArcGIS(geometry.type)),geoconverted)},serialize=function(params){var data="";for(var key in params)if(params.hasOwnProperty(key)){var value,param=params[key],type=Object.prototype.toString.call(param);data.length&&(data+=","),value="[object Array]"===type?"[object Object]"===Object.prototype.toString.call(param[0])?JSON.stringify(param):param.join(","):"[object Object]"===type?JSON.stringify(param):"[object Date]"===type?param.valueOf():'"'+param+'"',data+="geometries"==key?encodeURIComponent('"'+key+'"')+":"+encodeURIComponent("["+value+"]"):encodeURIComponent('"'+key+'"')+":"+encodeURIComponent(value)}return data};return _service};module.$inject=["$http","MapService","MapData"],module.factory("GeometryService",service)}(),function(){var module=angular.module("tink.gis"),service=function($http,HelperService,$q){var _service={};return _service.GetThemeData=function(url){var fullurl=url+"?request=GetCapabilities&service=WMS&callback=foo",prom=$http({method:"GET",url:HelperService.CreateProxyUrl(fullurl),timeout:1e4,transformResponse:function(data){return data&&(data=HelperService.UnwrapProxiedData(data),data.listOfHttpError?console.log(data.listOfHttpError,fullurl):data=JXON.stringToJs(data).wms_capabilities),data}}).success(function(data,status,headers,config){}).error(function(data,status,headers,config){console.log("error: data, status, headers, config:",data,status,headers,config)});return prom},_service};module.$inject=["$http","HelperService","$q"],module.factory("WMSService",service)}(),function(){try{var module=angular.module("tink.gis")}catch(e){var module=angular.module("tink.gis",["tink.accordion","tink.tinkApi"])}var baseLayersService=function(map){var _baseLayersService={};return _baseLayersService.basemap2Naam="geen",_baseLayersService.basemap1Naam="Geen",_baseLayersService.setBaseMap=function(id,naam,url){var maxZoom=arguments.length<=3||void 0===arguments[3]?19:arguments[3],minZoom=arguments.length<=4||void 0===arguments[4]?0:arguments[4],layer=L.esri.tiledMapLayer({url:url,maxZoom:maxZoom,minZoom:minZoom,continuousWorld:!0});1==id?(_baseLayersService.basemap1&&map.removeLayer(_baseLayersService.basemap1),_baseLayersService.basemap1Naam=naam,_baseLayersService.basemap1=layer,_baseLayersService.basemap1.addTo(map)):2==id&&(_baseLayersService.basemap2&&map.removeLayer(_baseLayersService.basemap2),_baseLayersService.basemap2=layer,_baseLayersService.basemap2Naam=naam)},_baseLayersService.setBaseMap(1,"Kaart","https://geodata.antwerpen.be/arcgissql/rest/services/P_Publiek/P_basemap/MapServer"),_baseLayersService.setBaseMap(2,"Luchtfoto","https://geodata.antwerpen.be/arcgissql/rest/services/P_Publiek/Luchtfoto_2015/MapServer"),_baseLayersService};module.factory("BaseLayersService",baseLayersService)}(),L.Draw.Rectangle=L.Draw.Rectangle.extend({_getTooltipText:function(){var latLngs,area,subtext,tooltipText=L.Draw.SimpleShape.prototype._getTooltipText.call(this),shape=this._shape;return shape&&(latLngs=this._shape.getLatLngs(),area=L.GeometryUtil.geodesicArea(latLngs),subtext=L.GeometryUtil.readableArea(area,this.options.metric)),{text:tooltipText.text,subtext:""}}}),function(){try{var module=angular.module("tink.gis")}catch(e){var module=angular.module("tink.gis",["tink.accordion","tink.tinkApi"])}var service=function(MapData,map){var _service={};return _service.StartDraw=function(DrawingOptie){switch(MapData.DrawingType){case DrawingOption.LIJN:case DrawingOption.AFSTAND:MapData.DrawingObject=new L.Draw.Polyline(map),MapData.DrawingObject.enable();break;case DrawingOption.POLYGON:case DrawingOption.OPPERVLAKTE:var polygon_options={showArea:!1,shapeOptions:{stroke:!0,color:"#22528b",weight:4,opacity:.6,fill:!0,fillColor:null,fillOpacity:.4,clickable:!0}};MapData.DrawingObject=new L.Draw.Polygon(map,polygon_options),MapData.DrawingObject.enable();break;case DrawingOption.VIERKANT:MapData.DrawingObject=new L.Draw.Rectangle(map,{metric:!1}),MapData.DrawingObject.enable()}},_service};module.factory("DrawService",service)}();var esri2geo={};!function(){function toGeoJSON(data,cb){if("string"==typeof data){if(cb)return void ajax(data,function(err,d){toGeoJSON(d,cb)});throw new TypeError("callback needed for url")}for(var outPut={type:"FeatureCollection",features:[]},fl=data.geometries.length,i=0;fl>i;){var ft=data.geometries[i],outFT={type:"Feature",properties:prop(ft.attributes)};ft.x?outFT.geometry=point(ft):ft.points?outFT.geometry=points(ft):ft.paths?outFT.geometry=line(ft):ft.rings&&(outFT.geometry=poly(ft)),outPut.features.push(outFT),i++}return outPut}function point(geometry){return{type:"Point",coordinates:[geometry.x,geometry.y]}}function points(geometry){return 1===geometry.points.length?{type:"Point",coordinates:geometry.points[0]}:{type:"MultiPoint",coordinates:geometry.points}}function line(geometry){return 1===geometry.paths.length?{type:"LineString",coordinates:geometry.paths[0]}:{type:"MultiLineString",coordinates:geometry.paths}}function poly(geometry){return 1===geometry.rings.length?{type:"Polygon",coordinates:geometry.rings}:decodePolygon(geometry.rings)}function decodePolygon(a){for(var type,coords=[],len=a.length,i=0,len2=coords.length-1;len>i;)ringIsClockwise(a[i])?(coords.push([a[i]]),len2++):coords[len2].push(a[i]),i++;return type=1===coords.length?"Polygon":"MultiPolygon",{type:type,coordinates:1===coords.length?coords[0]:coords}}function ringIsClockwise(ringToTest){var pt2,total=0,i=0,rLength=ringToTest.length,pt1=ringToTest[i];for(i;i<rLength-1;i++)pt2=ringToTest[i+1],total+=(pt2[0]-pt1[0])*(pt2[1]+pt1[1]),pt1=pt2;return total>=0}function prop(a){var p={};for(var k in a)a[k]&&(p[k]=a[k]);return p}function ajax(url,cb){if("undefined"!=typeof module){var request=require("request");return void request(url,{json:!0},function(e,r,b){cb(e,b)})}var req=new XMLHttpRequest;req.onreadystatechange=function(){4===req.readyState&&200===req.status&&cb(null,JSON.parse(req.responseText))},req.open("GET",url),req.send()}"undefined"!=typeof module?module.exports=toGeoJSON:esri2geo.toGeoJSON=toGeoJSON}(),function(){var module;try{module=angular.module("tink.gis")}catch(e){module=angular.module("tink.gis",["tink.accordion","tink.tinkApi","tink.modal"])}var externService=function(MapData,map,GISService,ThemeCreater,WMSService,ThemeService,$q,BaseLayersService){var _externService={};return _externService.GetAllThemes=function(){var legendItem={};return legendItem.EsriThemes=MapData.Themes.filter(function(x){return x.Type==ThemeType.ESRI}),legendItem.WmsThemes=MapData.Themes.filter(function(x){return x.Type==ThemeType.WMS}),legendItem},_externService.SetPrintPreview=function(){var cent=map.getCenter(),html=$("html");html.hasClass("print")||html.addClass("print"),html.hasClass("landscape")&&html.removeClass("landscape"),map.invalidateSize(!1),map.setView(cent)},_externService.Export=function(){var exportObject={},arr=MapData.Themes.map(function(theme){var returnitem={};return returnitem.Naam=theme.Naam,theme.Type==ThemeType.ESRI?returnitem.CleanUrl=theme.Url:returnitem.CleanUrl=theme.CleanUrl||theme.Url,returnitem.Type=theme.Type,returnitem.Visible=theme.Visible,returnitem.Layers=theme.AllLayers.filter(function(x){return 1==x.enabled}).map(function(layer){var returnlayer={};return returnlayer.visible=layer.visible,theme.Type==ThemeType.ESRI?(returnlayer.name=layer.name,returnlayer.id=layer.id):(returnlayer.name=layer.title,returnlayer.id=layer.title),returnlayer}),returnitem});return exportObject.Themes=arr,exportObject.Extent=map.getBounds(),exportObject.IsKaart=!0,exportObject},_externService.Import=function(project){console.log(project),_externService.setExtent(project.extent);var themesArray=[],promises=[];project.themes.forEach(function(theme){if(theme.type==ThemeType.ESRI){theme.cleanUrl=Gis.Arcgissql+theme.cleanUrl;var prom=GISService.GetThemeData(theme.cleanUrl);promises.push(prom),prom.then(function(data){var arcgistheme=ThemeCreater.createARCGISThemeFromJson(data,theme);themesArray.push(arcgistheme)})}else{var _prom=WMSService.GetThemeData(theme.cleanUrl);promises.push(_prom),_prom.success(function(data,status,headers,config){var wmstheme=ThemeCreater.createWMSThemeFromJSON(data,theme.cleanUrl);themesArray.push(wmstheme)}).error(function(data,status,headers,config){console.log("error!!!!!!!",data,status,headers,config)})}});var allpromises=$q.all(promises);return allpromises.then(function(){var orderedArray=[],errorMessages=[];project.themes.forEach(function(theme){var realTheme=themesArray.find(function(x){return x.CleanUrl==theme.cleanUrl});realTheme.Visible=theme.visible,console.log(theme," vs real theme: ",realTheme),realTheme.AllLayers.length==theme.layers.length?realTheme.Added=!0:realTheme.Added=null,realTheme.AllLayers.forEach(function(layer){layer.enabled=!1}),theme.layers.forEach(function(layer){var realLayer=realTheme.AllLayers.find(function(x){return x.title==layer.name});realLayer?(realLayer.visible=layer.visible,realLayer.enabled=!0):errorMessages.push('"'+layer.name+'" not found in mapserver: '+realTheme.Naam+".")})}),project.themes.forEach(function(theme){var realTheme=themesArray.find(function(x){return x.CleanUrl==theme.cleanUrl});orderedArray.unshift(realTheme),realTheme.status=ThemeStatus.NEW}),ThemeService.AddAndUpdateThemes(orderedArray),console.log("all loaded"),errorMessages.length>0&&alert(errorMessages.join("\n"))}),allpromises},_externService.setExtent=function(extent){map.fitBounds([[extent._northEast.lat,extent._northEast.lng],[extent._southWest.lat,extent._southWest.lng]])},_externService.CleanMapAndThemes=function(){MapData.CleanMap(),ThemeService.CleanThemes()},_externService.LoadConfig=function(config){Gis.GeometryUrl=config.Gis.GeometryUrl,Gis.BaseUrl=config.Gis.BaseUrl,Style.Default=config.Style.Default,Style.HIGHLIGHT=config.Style.HIGHLIGHT,Style.BUFFER=config.Style.BUFFER,BaseLayersService.setBaseMap(1,config.BaseKaart1.Naam,config.BaseKaart1.Url,config.BaseKaart1.MaxZoom,config.BaseKaart1.MinZoom),BaseLayersService.setBaseMap(2,config.BaseKaart2.Naam,config.BaseKaart2.Url,config.BaseKaart2.MaxZoom,config.BaseKaart2.MinZoom)},_externService};module.factory("ExternService",externService)}();var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj};!function(){var module;try{module=angular.module("tink.gis")}catch(e){module=angular.module("tink.gis",["tink.accordion","tink.tinkApi","ui.sortable","tink.modal","angular.filter","tink.pagination"])}var service=function(){var _service={};proj4.defs("EPSG:31370","+proj=lcc +lat_1=51.16666723333334 +lat_2=49.83333389999999 +lat_0=90 +lon_0=4.367486666666666 +x_0=150000.013 +y_0=5400088.438 +ellps=intl +towgs84=-99.1,53.3,-112.5,0.419,-0.83,1.885,-1.0 +units=m +no_defs");var getApiURL=function(){return window.location.href.startsWith("https://stadinkaart-a.antwerpen.be/")?(console.log("ACC"),"https://stadinkaart-a.antwerpen.be/digipolis.stadinkaart.api/"):window.location.href.startsWith("https://stadinkaart-o.antwerpen.be/")?(console.log("O"),"https://stadinkaart-o.antwerpen.be/digipolis.stadinkaart.api/"):(console.log("LOC"),"https://localhost/digipolis.stadinkaart.api/")};_service.getEnvironment=function(){return window.location.href.startsWith("https://stadinkaart-a.antwerpen.be/")?(console.log("ACC"),"A"):window.location.href.startsWith("https://stadinkaart-o.antwerpen.be/")?(console.log("O"),"O"):window.location.href.startsWith("https://localhost/")?"D":"L"},_service.CreateProxyUrl=function(url){return getApiURL()+"Proxy/go?url="+encodeURIComponent(url)},_service.UnwrapProxiedData=function(data){return"string"==typeof data&&data.startsWith('{"listOfString":')?data=$.parseJSON(data).listOfString:"object"==("undefined"==typeof data?"undefined":_typeof(data))&&data.listOfString&&(data=data.listOfString),"string"==typeof data&&data.startsWith("{")&&(data=JSON.parse(data)),data},_service.ConvertWSG84ToLambert72=function(coordinates){var result=proj4("EPSG:31370",[coordinates.lng||coordinates.x,coordinates.lat||coordinates.y]);return{x:result[0],y:result[1]}},_service.ConvertLambert72ToWSG84=function(coordinates){var x=coordinates.lng||coordinates.x||coordinates[0],y=coordinates.lat||coordinates.y||coordinates[1],result=proj4("EPSG:31370","WGS84",[x,y]);return{y:result[0],x:result[1]}};var isCharDigit=function(n){return" "!=n&&n>-1};return _service.getWGS84CordsFromString=function(search){var returnobject={};returnobject.hasCordinates=!1,returnobject.error=null,returnobject.x=null,returnobject.y=null;var currgetal="",samegetal=!1,aantalmetcorrectesize=0,hasaseperater=!1,getals=[];if((search.contains("51.")||search.contains("51,"))&&(search.contains("4.")||search.contains("4,"))){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=search[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var char=_step.value;isCharDigit(char)?samegetal?currgetal+=char:(currgetal=""+char,samegetal=!0):"51"!=currgetal&&"4"!=currgetal||"."!=char&&","!=char||0!=hasaseperater?(""!=currgetal&&getals.push(currgetal),currgetal="",samegetal=!1,hasaseperater=!1):(currgetal+=char,aantalmetcorrectesize++,hasaseperater=!0)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}""!=currgetal&&getals.push(currgetal)}return 2==aantalmetcorrectesize&&2==getals.length?(returnobject.x=getals[0].replace(",","."),returnobject.y=getals[1].replace(",","."),returnobject.hasCordinates=!0,returnobject):(returnobject.error="Incorrect format: X,Y is required",returnobject)},_service.getLambartCordsFromString=function(search){var returnobject={};returnobject.hasCordinates=!1,returnobject.error=null,returnobject.x=null,returnobject.y=null;var getals=[],currgetal="",samegetal=!1,aantalmet6size=0,hasaseperater=!1,_iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=search[Symbol.iterator]();!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var char=_step2.value;if(isCharDigit(char))samegetal?currgetal+=char:(currgetal=""+char,samegetal=!0);else{if(6==currgetal.length){if(!(currgetal>125e3&&currgetal<175e3||currgetal>18e4&&currgetal<24e4))return returnobject.error="Out of bounds cordinaten voor Antwerpen.",returnobject;aantalmet6size++}","!=char&&"."!=char||0!=hasaseperater?(hasaseperater=!1,getals.push(currgetal),currgetal="",samegetal=!1):(hasaseperater=!0,currgetal+=char)}}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}""!=currgetal&&(6==currgetal.length&&aantalmet6size++,getals.push(currgetal));var getals=getals.filter(function(x){return""!=x.trim()});return 2==aantalmet6size&&2==getals.length?(returnobject.x=getals[0].replace(",","."),returnobject.y=getals[1].replace(",","."),returnobject.hasCordinates=!0,returnobject):(returnobject.error="Incorrect format: Lat,Lng is required",returnobject)},_service};module.factory("HelperService",service)}(),function(){var module;try{module=angular.module("tink.gis")}catch(e){module=angular.module("tink.gis",["tink.accordion","tink.tinkApi",["ui.sortable"]])}var layersService=function(){var _layersService={};return _layersService};module.$inject=[],module.factory("LayersService",layersService)}(),L.Control.Typeahead=L.Control.extend({options:{position:"topleft"},initialize:function(args){this.arguments=[];for(var i=0;i<args.length-1;i++)this.arguments.push(args[i]);L.Util.setOptions(this,args[args.length-1])},onAdd:function(map){var that=this,container=L.DomUtil.create("div","");return container.style.position="absolute",this.typeahead=L.DomUtil.create("input","typeahead tt-input",container),this.typeahead.type="text",this.typeahead.placeholder=this.options.placeholder,$(this.typeahead).typeahead.apply($(this.typeahead),this.arguments),["typeahead:active","typeahead:idle","typeahead:open","typeahead:close","typeahead:change","typeahead:render","typeahead:select","typeahead:autocomplete","typeahead:cursorchange","typeahead:asyncrequest","typeahead:asynccancel","typeahead:asyncreceive"].forEach(function(method){that.options[method]&&$(that.typeahead).bind(method,that.options[method])}),L.DomEvent.disableClickPropagation(container),container},onRemove:function(map){},keyup:function(e){38===e.keyCode||40===e.keyCode},itemSelected:function(e){L.DomEvent.preventDefault(e)},submit:function(e){L.DomEvent.preventDefault(e)}}),L.control.typeahead=function(args){return new L.Control.Typeahead(arguments)},function(){var module=angular.module("tink.gis"),mapData=function(map,$rootScope,HelperService,ResultsData,$compile){function copyToClipboard(element){var $temp=$("<input>");$("body").append($temp),$temp.val($(element).text()).select(),document.execCommand("copy"),$temp.remove()}var _data={};_data.VisibleLayers=[],_data.SelectableLayers=[],_data.VisibleFeatures=[],_data.Loading=0,_data.IsDrawing=!1,_data.Themes=[],_data.defaultlayer={id:"",name:"Alle Layers"},_data.SelectedLayer=_data.defaultlayer,_data.VisibleLayers.unshift(_data.defaultlayer),_data.ResetVisibleLayers=function(){var curSelectedLayer=_data.SelectedLayer;_data.VisibleLayers.length=0,_data.Themes.forEach(function(x){_data.VisibleLayers=_data.VisibleLayers.concat(x.VisibleLayers)}),_data.VisibleLayers=_data.VisibleLayers.sort(function(x){return x.title}),_data.VisibleLayers.unshift(_data.defaultlayer);var reselectLayer=_data.VisibleLayers.find(function(x){return x.name==curSelectedLayer.name});reselectLayer?_data.SelectedLayer=reselectLayer:_data.SelectedLayer=_data.defaultlayer},_data.ActiveInteractieKnop=ActiveInteractieButton.IDENTIFY,_data.DrawingType=DrawingOption.NIETS,_data.DrawingObject=null,_data.LastIdentifyBounds=null,_data.CleanDrawings=function(){_data.DrawingObject&&(_data.DrawingObject.layer&&(_data.DrawingObject.layer._popup=null),_data.DrawingObject.disable(),_data.DrawingObject=null,map.clearDrawings())};var WatIsHierMarker=null,WatIsHierOriginalMarker=null;_data.CleanMap=function(){_data.CleanDrawings(),_data.CleanWatIsHier(),_data.CleanBuffer(),_data.CleanTempFeatures()},_data.bufferLaag=null,_data.CreateBuffer=function(gisBufferData){var esrigj=esri2geo.toGeoJSON(gisBufferData),gj=new L.GeoJSON(esrigj,{style:Style.BUFFER});return _data.bufferLaag=gj.addTo(map),map.fitBounds(_data.bufferLaag.getBounds()),_data.bufferLaag},_data.CleanBuffer=function(){_data.bufferLaag&&(map.removeLayer(_data.bufferLaag),_data.bufferLaag=null)},_data.CleanTempFeatures=function(){tempFeatures.forEach(function(tempfeature){map.removeLayer(tempfeature)}),tempFeatures.length=0},_data.GetZoomLevel=function(){return map.getZoom()},_data.GetScale=function(){return Scales[_data.GetZoomLevel()]},_data.CleanWatIsHier=function(){WatIsHierOriginalMarker&&(WatIsHierOriginalMarker.clearAllEventListeners(),WatIsHierOriginalMarker.closePopup(),map.removeLayer(WatIsHierOriginalMarker),WatIsHierOriginalMarker=null),WatIsHierMarker&&(map.removeLayer(WatIsHierMarker),WatIsHierMarker=null)},_data.UpdateDisplayed=function(Themes){var currentScale=_data.GetScale();_data.Themes.forEach(function(theme){theme.Type==ThemeType.ESRI&&theme.UpdateDisplayed(currentScale)})},_data.Apply=function(){console.log("apply"),$rootScope.$$phase?console.log("apply NOT needed"):$rootScope.$apply()},_data.CreateOrigineleMarker=function(latlng,addressFound,straatNaam){if(addressFound){var foundMarker=L.AwesomeMarkers.icon({icon:"fa-map-marker",markerColor:"orange"});WatIsHierOriginalMarker=L.marker([latlng.lat,latlng.lng],{icon:foundMarker,opacity:.5}).addTo(map)}else{var notFoundMarker=L.AwesomeMarkers.icon({icon:"fa-question",markerColor:"red",spin:!0});WatIsHierOriginalMarker=L.marker([latlng.lat,latlng.lng],{icon:notFoundMarker}).addTo(map)}var convertedxy=HelperService.ConvertWSG84ToLambert72(latlng),html="",minwidth=0;straatNaam?(html='<div class="container container-low-padding"><div class="row row-no-padding"><div class="col-sm-4"><a href="http://maps.google.com/maps?q=&layer=c&cbll='+latlng.lat+","+latlng.lng+'" + target="_blank" ><img src="https://maps.googleapis.com/maps/api/streetview?size=100x50&location='+latlng.lat+","+latlng.lng+'&pitch=-0.76" /></a></div><div class="col-sm-8 mouse-over"><div class="col-sm-12"><b>'+straatNaam+'</b></div><div class="col-sm-3">WGS84:</div><div id="wgs" class="col-sm-8" style="text-align: left;">{{WGS84LatLng}}</div><div class="col-sm-1"><i class="fa fa-files-o mouse-over-toshow" ng-click="CopyWGS()"></i></div><div class="col-sm-3">Lambert:</div><div id="lambert" class="col-sm-8" style="text-align: left;">{{LambertLatLng}}</div><div class="col-sm-1"><i class="fa fa-files-o mouse-over-toshow"  ng-click="CopyLambert()"></i></div></div></div></div>',minwidth=300):(html='<div class="container container-low-padding"><div class="row row-no-padding mouse-over"><div class="col-sm-3">WGS84:</div><div id="wgs" class="col-sm-8 " style="text-align: left;">{{WGS84LatLng}}</div><div class="col-sm-1"><i class="fa fa-files-o mouse-over-toshow" ng-click="CopyWGS()"></i></div><div class="col-sm-3">Lambert:</div><div id="lambert" class="col-sm-8" style="text-align: left;">{{LambertLatLng}}</div><div class="col-sm-1"><i class="fa fa-files-o mouse-over-toshow" ng-click="CopyLambert()"></i></div></div></div>',minwidth=200);var linkFunction=$compile(html),newScope=$rootScope.$new();newScope.LambertLatLng=convertedxy.x.toFixed(1)+", "+convertedxy.y.toFixed(1),newScope.CopyLambert=function(){copyToClipboard("#lambert")},newScope.CopyWGS=function(){copyToClipboard("#wgs")},newScope.WGS84LatLng=latlng.lat.toFixed(6)+", "+latlng.lng.toFixed(6);var domele=linkFunction(newScope)[0],popup=WatIsHierOriginalMarker.bindPopup(domele,{minWidth:minwidth,closeButton:!0}).openPopup();popup.on("popupclose",function(){_data.CleanWatIsHier()})},_data.CreateDot=function(loc){_data.CleanWatIsHier();var dotIcon=L.icon({iconUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAABKVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABUJ5OrAAAAYnRSTlMAAQIEBQYICgsNDg8QERITFxgaGyAhJSYoKS8wMTU2ODk7QkRPVFVXXV5fYWJkZ2lrbHF3eHyAg4aMjpSXmJ6jpqirra+wsrS3ucDByszP0dPc3uDi5Obo6evt7/P19/n7/fGWhfoAAAERSURBVBgZXcGHIoJhGIbh5+uXZO+sZK/slZ0tMwkhwn3+B+HtrxTXpapgKOj0n4slC8DX+binWrEcFe8T+uV2qXXhqcSdYvYGmurD/Ylv4M6TLwGk21QSugROVBQBjgKqcFvAmMwNPHiqclfwEpC6gB4VRdeWumQagai0CLcy7hwzK7MPe9IFzMjE8XVKisGr9AyDMhl8C5LagYA+ISLzhm9VUjPgKQvDMtv4hiR1Ak5JWJFpyGPOZMYhI03Bo4oadvKZuJNJwabUDIyqVjfQK+kICmFV1T1BWqYVuA+rIpgCIiqaBD5GVNKXAzZUso7JLkcjQ3NpzIFT2RS11lTVdkzFdbf+aJk+zH4+n813qOwHxGRbFJ0DoNgAAAAASUVORK5CYII=",iconSize:[24,24]});WatIsHierMarker=L.marker([loc.x,loc.y],{icon:dotIcon}).addTo(map)},_data.CleanSearch=function(){ResultsData.CleanSearch();for(var x=0;x<_data.VisibleFeatures.length;x++)map.removeLayer(_data.VisibleFeatures[x]);_data.VisibleFeatures.length=0},_data.PanToPoint=function(loc){map.setView(L.latLng(loc.x,loc.y),12)},_data.PanToFeature=function(feature){console.log("PANNING TO FEATURE");var featureBounds=feature.getBounds();map.fitBounds(featureBounds)},_data.GoToLastClickBounds=function(){map.fitBounds(_data.LastIdentifyBounds,{paddingTopLeft:L.point(0,0),paddingBottomRight:L.point(0,0)})},_data.SetZIndexes=function(){var counter=_data.Themes.length+3;_data.Themes.forEach(function(theme){theme.MapData.ZIndex=counter,theme.Type==ThemeType.ESRI?theme.MapData._currentImage&&(theme.MapData._currentImage._image.style.zIndex=counter):(theme.MapData.bringToFront(),theme.MapData.setZIndex(counter)),counter--})},_data.QueryForTempFeatures=function(layerid,where){locatieMapData.query().layer(layerid).where(where).run(function(error,featureCollection,response){error?console.log("ERRRORRRRRRRRRRR",error):(console.log(error,featureCollection,response),_data.AddTempFeatures(featureCollection))})};var locatieMapData=L.esri.dynamicMapLayer({maxZoom:19,minZoom:0,url:"https://geoint-a.antwerpen.be/arcgissql/rest/services/A_DA/Locaties/MapServer",opacity:1,layers:0,continuousWorld:!0,useCors:!0}),tempFeatures=[];return _data.AddTempFeatures=function(featureCollection){featureCollection.features.forEach(function(feature){var mapItem=L.geoJson(feature,{style:Style.DEFAULT}).addTo(map);_data.PanToFeature(mapItem),tempFeatures.push(mapItem)})},_data.AddFeatures=function(features,theme,layerId){if(features&&0!=features.features.length){ResultsData.EmptyResult=!1;for(var x=0;x<features.features.length;x++){var featureItem=features.features[x],layer={};if(null!=featureItem.layerId?layer=theme.AllLayers.find(function(x){return x.id===featureItem.layerId}):null!=layerId?layer=theme.AllLayers.find(function(x){return x.id===layerId}):console.log("NO LAYER ID WAS GIVEN EITHER FROM FEATURE ITEM OR FROM PARAMETER"),featureItem.theme=theme,featureItem.layerName=layer.name,theme.Type===ThemeType.ESRI){if(layer.fields.forEach(function(field){if("esriFieldTypeDate"==field.type){var date=new Date(featureItem.properties[field.name]),date_string=date.getDate()+1+"/"+(date.getMonth()+1)+"/"+date.getFullYear();featureItem.properties[field.name]=date_string}}),featureItem.displayValue=featureItem.properties[layer.displayField],!featureItem.displayValue){var displayFieldProperties=layer.fields.find(function(x){return x.name==layer.displayField});displayFieldProperties&&featureItem.properties[displayFieldProperties.alias]?featureItem.displayValue=featureItem.properties[displayFieldProperties.alias]:featureItem.displayValue="LEEG"}""==featureItem.displayValue.toString().trim()&&(featureItem.displayValue="LEEG");var mapItem=L.geoJson(featureItem,{style:Style.DEFAULT}).addTo(map);_data.VisibleFeatures.push(mapItem),featureItem.mapItem=mapItem}else featureItem.displayValue=featureItem.properties[Object.keys(featureItem.properties)[0]];ResultsData.JsonFeatures.push(featureItem)}$rootScope.$apply()}else ResultsData.EmptyResult=!0},_data};module.$inject=["ResultsData"],module.factory("MapData",mapData)}(),function(){var module=angular.module("tink.gis"),mapEvents=function(map,MapService,MapData,UIService){var _mapEvents={};map.on("draw:drawstart",function(event){console.log("draw started"),MapData.IsDrawing=!0}),map.on("draw:drawstop",function(event){console.log("draw stopped"),MapData.IsDrawing=!1});var berekendAfstand=function(arrayOfPoints){for(var totalDistance=0,x=0;x!=arrayOfPoints.length-1;x++){var currpoint=arrayOfPoints[x],nextpoint=arrayOfPoints[x+1];totalDistance+=currpoint.distanceTo(nextpoint)}return totalDistance.toFixed(2)},berkenOmtrek=function(arrayOfPoints){for(var totalDistance=0,x=0;x!=arrayOfPoints.length;x++){var currpoint=arrayOfPoints[x];if(x==arrayOfPoints.length-1)var nextpoint=arrayOfPoints[0];else var nextpoint=arrayOfPoints[x+1];totalDistance+=currpoint.distanceTo(nextpoint);
}return totalDistance.toFixed(2)};map.on("zoomend",function(event){console.log("Zoomend!!!"),MapData.UpdateDisplayed(),MapData.Apply()}),map.on("click",function(event){if(event.originalEvent instanceof MouseEvent)if(console.log("click op map! Is drawing: "+MapData.IsDrawing),MapData.IsDrawing)switch(console.log("DrawingObject: "),console.log(MapData.DrawingObject),MapData.DrawingType){case DrawingOption.AFSTAND:break;case DrawingOption.OPPERVLAKTE:break;default:console.log("Aant drawen zonder een gekent type!!!!!!")}else switch(MapData.CleanMap(),MapData.ActiveInteractieKnop){case ActiveInteractieButton.IDENTIFY:MapData.LastIdentifyBounds=map.getBounds(),MapService.Identify(event,10),UIService.OpenLeftSide();break;case ActiveInteractieButton.SELECT:MapData.DrawingType===DrawingOption.NIETS&&(MapService.Select(event),UIService.OpenLeftSide());break;case ActiveInteractieButton.WATISHIER:MapService.WatIsHier(event);break;case ActiveInteractieButton.METEN:break;default:console.log("MAG NIET!!!!!!!!")}}),map.on("draw:created",function(e){switch(console.log("draw created"),MapData.ActiveInteractieKnop){case ActiveInteractieButton.SELECT:switch(MapData.DrawingType){case DrawingOption.LIJN:break;case DrawingOption.VIERKANT:break;case DrawingOption.POLYGON:}MapService.Query(e.layer),UIService.OpenLeftSide();break;case ActiveInteractieButton.METEN:switch(MapData.DrawingType){case DrawingOption.AFSTAND:var afstand=berekendAfstand(e.layer._latlngs),popup=e.layer.bindPopup("Afstand (m): "+afstand+" ");popup.on("popupclose",function(event){MapData.CleanMap()}),e.layer.openPopup();break;case DrawingOption.OPPERVLAKTE:var omtrek=berkenOmtrek(e.layer._latlngs[0]),popuptekst="<p>Opp  (m<sup>2</sup>): "+LGeo.area(e.layer).toFixed(2)+"</p><p>Omtrek (m): "+omtrek+" </p>",popup=e.layer.bindPopup(popuptekst);popup.on("popupclose",function(event){MapData.CleanMap()}),e.layer.openPopup()}break;default:console.log("MAG NIET!!!!!!!!")}MapData.IsDrawing=!1});var gpsmarker=null;return map.on("locationfound",function(e){_mapEvents.ClearGPS();var gpsicon=L.divIcon({className:"fa fa-crosshairs fa-2x blue",style:"color: blue"});gpsmarker=L.marker(e.latlng,{icon:gpsicon}).addTo(map)}),_mapEvents.ClearGPS=function(){gpsmarker&&gpsmarker.removeFrom(map)},map.on("locationerror",function(e){console.log("LOCATIONERROR",e)}),_mapEvents};module.$inject=["map","MapService","MapData","UIService"],module.factory("MapEvents",mapEvents)}();var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj};!function(){var module;try{module=angular.module("tink.gis")}catch(e){module=angular.module("tink.gis",["tink.accordion","tink.tinkApi","tink.modal"])}var mapService=function($rootScope,MapData,map,ThemeCreater,$q,GISService,ResultsData,HelperService){var _mapService={};return _mapService.Identify=function(event,tolerance){MapData.CleanSearch(),"undefined"==typeof tolerance&&(tolerance=10),_.each(MapData.Themes,function(theme){var identifOnThisTheme=!0;if(1===theme.VisibleLayerIds.length&&theme.VisibleLayerIds[0]===-1&&(identifOnThisTheme=!1),identifOnThisTheme)switch(theme.Type){case ThemeType.ESRI:var layersVoorIdentify="visible: "+theme.VisibleLayerIds;ResultsData.RequestStarted++,theme.MapData.identify().on(map).at(event.latlng).layers(layersVoorIdentify).tolerance(tolerance).run(function(error,featureCollection){ResultsData.RequestCompleted++,MapData.AddFeatures(featureCollection,theme)});break;case ThemeType.WMS:var layersVoorIdentify=theme.VisibleLayerIds;theme.VisibleLayers.forEach(function(lay){console.log(lay),1==lay.queryable&&(ResultsData.RequestStarted++,theme.MapData.getFeatureInfo(event.latlng,lay.name).success(function(data,status,xhr){data=HelperService.UnwrapProxiedData(data),ResultsData.RequestCompleted++,console.log("minus");var returnjson=JXON.stringToJs(data),processedjson=null;returnjson.featureinforesponse&&(processedjson=returnjson.featureinforesponse.fields);var returnitem={type:"FeatureCollection",features:[]};if(processedjson){var featureArr=[];"object"===("undefined"==typeof processedjson?"undefined":_typeof(processedjson))?featureArr.push(processedjson):featureArr=processedjson,featureArr.forEach(function(feat){var tmpitem={layerName:lay.name,name:lay.name,layerId:lay.name,properties:feat,type:"Feature"};returnitem.features.push(tmpitem)}),console.log(lay.name+" item info: "),console.log(returnitem),MapData.AddFeatures(returnitem,theme)}else $rootScope.$apply()}))});break;default:console.log("UNKNOW TYPE!!!!:"),console.log(Theme.Type)}})},_mapService.Select=function(event){MapData.CleanSearch(),console.log(event),""==MapData.SelectedLayer.id?MapData.Themes.filter(function(x){return x.Type==ThemeType.ESRI}).forEach(function(theme){ResultsData.RequestStarted++,theme.MapData.identify().on(map).at(event.latlng).layers("visible: "+theme.VisibleLayerIds).run(function(error,featureCollection){ResultsData.RequestCompleted++,MapData.AddFeatures(featureCollection,theme)})}):(ResultsData.RequestStarted++,MapData.SelectedLayer.theme.MapData.identify().on(map).at(event.latlng).layers("visible: "+MapData.SelectedLayer.id).run(function(error,featureCollection){ResultsData.RequestCompleted++,MapData.AddFeatures(featureCollection,MapData.SelectedLayer.theme)}))},_mapService.WatIsHier=function(event){var prom=GISService.ReverseGeocode(event);prom.success(function(data,status,headers,config){if(MapData.CleanWatIsHier(),data.error)MapData.CreateOrigineleMarker(event.latlng,!1);else{var converted=HelperService.ConvertLambert72ToWSG84(data.location);MapData.CreateDot(converted),MapData.CreateOrigineleMarker(event.latlng,!0,data.address.Street+" ("+data.address.Postal+")")}}).error(function(data,status,headers,config){console.log(data,status,headers,config)})},_mapService.Query=function(box,layer){MapData.CleanSearch(),layer||(layer=MapData.SelectedLayer),layer&&""!=layer.id?(ResultsData.RequestStarted++,layer.theme.MapData.query().layer(layer.id).intersects(box).run(function(error,featureCollection,response){ResultsData.RequestCompleted++,MapData.AddFeatures(featureCollection,layer.theme,layer.id)})):MapData.Themes.forEach(function(theme){theme.Type===ThemeType.ESRI&&theme.VisibleLayers.forEach(function(lay){ResultsData.RequestStarted++,theme.MapData.query().layer(lay.id).intersects(box).run(function(error,featureCollection,response){ResultsData.RequestCompleted++,MapData.AddFeatures(featureCollection,theme,lay.id)})})})},_mapService.Find=function(query){MapData.CleanSearch(),MapData.SelectedLayer&&""==MapData.SelectedLayer.id?MapData.Themes.forEach(function(theme){theme.Type===ThemeType.ESRI&&theme.VisibleLayers.forEach(function(lay){ResultsData.RequestStarted++,theme.MapData.find().fields(lay.displayField).layers(lay.id).text(query).run(function(error,featureCollection,response){ResultsData.RequestCompleted++,MapData.AddFeatures(featureCollection,theme,lay.id)})})}):(ResultsData.RequestStarted++,MapData.SelectedLayer.theme.MapData.find().fields(MapData.SelectedLayer.displayField).layers(MapData.SelectedLayer.id).text(query).run(function(error,featureCollection,response){ResultsData.RequestCompleted++,MapData.AddFeatures(featureCollection,MapData.SelectedLayer.theme,MapData.SelectedLayer.id)}))},_mapService};module.$inject=["$rootScope","MapData","map","ThemeCreater","$q","GISService","ResultsData","HelperService"],module.factory("MapService",mapService)}(),function(){var module;try{module=angular.module("tink.gis")}catch(e){module=angular.module("tink.gis",["tink.accordion","tink.tinkApi","tink.modal"])}var popupService=function(MapData,map,GISService,ThemeCreater,WMSService,ThemeService,$q,BaseLayersService){var _popupService={};return _popupService.Init=function(){toastr.options.timeOut=1e4,toastr.options.extendedTimeOut=1e4,toastr.options.closeButton=!0}(),_popupService.popupGenerator=function(type,message,title,callback,options){var messagetype=type.toLowerCase().trim();if("error"!=messagetype&&"warning"!=messagetype&&"info"!=messagetype&&"success"!=messagetype)throw"Invalid toastr type(info, error, warning,  success): "+messagetype;options||(options={}),callback&&(options={onclick:callback}),toastr[messagetype](message,null,options)},_popupService.Error=function(message,title,callback,options){_popupService.popupGenerator("Error",message,title,callback,options)},_popupService.Warning=function(message,title,callback,options){_popupService.popupGenerator("Warning",message,title,callback,options)},_popupService.Info=function(message,title,callback,options){_popupService.popupGenerator("Info",message,title,callback,options)},_popupService.Success=function(message,title,callback,options){_popupService.popupGenerator("Success",message,title,callback,options)},_popupService};module.factory("PopupService",popupService)}(),function(){var module=angular.module("tink.gis"),service=function(map,ThemeCreater,MapData,GISService){var _service={};return _service.AddAndUpdateThemes=function(themesBatch){console.log("Themes batch for add and updates..."),console.log(themesBatch),themesBatch.forEach(function(theme){var existingTheme=MapData.Themes.find(function(x){return x.CleanUrl==theme.CleanUrl});switch(console.log("addorupdate or del theme, ",theme,theme.status),theme.status){case ThemeStatus.NEW:theme.Type==ThemeType.ESRI&&(GISService.GetAditionalLayerInfo(theme),theme.UpdateDisplayed(MapData.GetScale())),_service.AddNewTheme(theme);break;case ThemeStatus.DELETED:_service.DeleteTheme(existingTheme);break;case ThemeStatus.UNMODIFIED:break;case ThemeStatus.UPDATED:_service.UpdateTheme(theme,existingTheme),_service.UpdateThemeVisibleLayers(existingTheme);break;default:console.log("Er is iets fout, status niet bekend!!!: "+theme.status)}theme.status=ThemeStatus.UNMODIFIED}),console.log("refresh of sortableThemes"),$("#sortableThemes").sortable("refresh"),MapData.SetZIndexes()},_service.UpdateThemeVisibleLayers=function(theme){MapData.ResetVisibleLayers(),theme.UpdateMap(map)},_service.UpdateTheme=function(updatedTheme,existingTheme){for(var x=0;x<updatedTheme.AllLayers.length;x++){var updatedLayer=updatedTheme.AllLayers[x],existingLayer=existingTheme.AllLayers[x];updatedLayer.enabled&&updatedLayer.visible?(existingTheme.Type==ThemeType.ESRI&&MapData.VisibleLayers.indexOf(existingLayer)==-1&&MapData.VisibleLayers.push(existingLayer),existingTheme.VisibleLayers.indexOf(existingLayer)==-1&&existingTheme.VisibleLayers.push(existingLayer)):(existingTheme.Type==ThemeType.ESRI&&MapData.VisibleLayers.indexOf(existingLayer)!=-1&&MapData.VisibleLayers.splice(MapData.VisibleLayers.indexOf(existingLayer),1),existingTheme.VisibleLayers.indexOf(existingLayer)!=-1&&existingTheme.VisibleLayers.splice(existingTheme.VisibleLayers.indexOf(existingLayer),1)),existingLayer.enabled=updatedLayer.enabled,existingLayer.visible=updatedLayer.visible}},_service.AddNewTheme=function(theme){switch(MapData.Themes.unshift(theme),theme.Type==ThemeType.ESRI&&(MapData.VisibleLayers=MapData.VisibleLayers.concat(theme.VisibleLayers)),theme.Type){case ThemeType.ESRI:theme.MapData=L.esri.dynamicMapLayer({maxZoom:19,minZoom:0,url:theme.CleanUrl,opacity:1,layers:theme.VisibleLayerIds,continuousWorld:!0,useCors:!0}).addTo(map),theme.MapData.on("load",function(e){theme.MapData._currentImage&&(theme.MapData._currentImage._image.style.zIndex=theme.MapData.ZIndex,console.log("Zindex on "+theme.Naam+" set to "+theme.MapData.ZIndex))});break;case ThemeType.WMS:theme.MapData=L.tileLayer.betterWms(theme.CleanUrl,{maxZoom:19,minZoom:0,format:"image/png",layers:theme.VisibleLayerIds.join(","),transparent:!0,continuousWorld:!0,useCors:!0}).addTo(map),theme.MapData.on("load",function(e){console.log("LOAD VAN "+theme.Naam),console.log(theme.MapData),theme.MapData._container.childNodes&&([].slice.call(theme.MapData._container.childNodes).forEach(function(imgNode){imgNode.style.zIndex=theme.MapData.ZIndex}),console.log("Zindex on "+theme.Naam+" set to "+theme.MapData.ZIndex))});break;default:console.log("UNKNOW TYPE")}},_service.CleanThemes=function(){for(;0!=MapData.Themes.length;)console.log("DELETING THIS THEME",MapData.Themes[0]),_service.DeleteTheme(MapData.Themes[0])},_service.DeleteTheme=function(theme){map.removeLayer(theme.MapData);var themeIndex=MapData.Themes.indexOf(theme);themeIndex>-1&&MapData.Themes.splice(themeIndex,1),theme.VisibleLayers.forEach(function(visLayer){var visLayerIndex=MapData.VisibleLayers.indexOf(visLayer);visLayerIndex>-1&&MapData.VisibleLayers.splice(visLayerIndex,1)}),MapData.CleanSearch()},_service};module.$inject=["map","ThemeCreater","MapData","GISService"],module.factory("ThemeService",service)}(),function(){var module;try{module=angular.module("tink.gis")}catch(e){module=angular.module("tink.gis",["tink.accordion","tink.tinkApi","ui.sortable","tink.modal","angular.filter","tink.pagination"])}var service=function(){var _service={};return _service.OpenLeftSide=function(){var html=$("html");html.hasClass("nav-left-open")||html.addClass("nav-left-open")},_service};module.factory("UIService",service)}(),function(module){var module;try{module=angular.module("tink.gis")}catch(e){module=angular.module("tink.gis",["tink.accordion","tink.tinkApi","ui.sortable","tink.modal","angular.filter"])}module.controller("BufferController",["$scope","$modalInstance","MapData",function($scope,$modalInstance,MapData){$scope.buffer=100,$scope.SelectableLayers=angular.copy(MapData.VisibleLayers),$scope.SelectableLayers.shift(),$scope.selectedLayer=$scope.SelectableLayers[0],$scope.ok=function(){$modalInstance.$close({buffer:$scope.buffer,layer:$scope.selectedLayer})},$scope.cancel=function(){$modalInstance.$dismiss("cancel is pressed")}}])}(),function(module){module=angular.module("tink.gis");var theController=module.controller("searchController",function($scope,ResultsData,map){var vm=this;vm.features=ResultsData.JsonFeatures,vm.EmptyResult=ResultsData.EmptyResult,vm.LoadingCompleted=function(){return ResultsData.GetRequestPercentage()>=100},vm.loadingPercentage=function(){return ResultsData.GetRequestPercentage()}});theController.$inject=["$scope","ResultsData","map"]}(),function(module){module=angular.module("tink.gis");var theController=module.controller("searchResultsController",function($scope,ResultsData,map,SearchService,MapData){var vm=this;vm.features=ResultsData.JsonFeatures,vm.featureLayers=null,vm.selectedResult=null,vm.layerGroupFilter="geenfilter",$scope.$watchCollection(function(){return ResultsData.JsonFeatures},function(newValue,oldValue){vm.featureLayers=_.uniq(_.map(vm.features,"layerName")),vm.layerGroupFilter="geenfilter"}),$scope.$watch(function(){return ResultsData.SelectedFeature},function(newVal,oldVal){vm.selectedResult=newVal}),vm.deleteFeature=function(feature){SearchService.DeleteFeature(feature)},vm.aantalFeaturesMetType=function(type){return vm.features.filter(function(x){return x.layerName==type}).length},vm.deleteFeatureGroup=function(featureGroupName){SearchService.DeleteFeatureGroup(featureGroupName)},vm.showDetails=function(feature){"esri"===feature.theme.Type&&("Point"==feature.geometry.type?MapData.PanToPoint({x:feature.geometry.coordinates[1],y:feature.geometry.coordinates[0]}):MapData.PanToFeature(feature.mapItem)),ResultsData.SelectedFeature=feature},vm.exportToCSV=function(){SearchService.ExportToCSV()}});theController.$inject=["$scope","ResultsData","map","MapData"]}(),function(module){module=angular.module("tink.gis");var theController=module.controller("searchSelectedController",function($scope,ResultsData,MapData,SearchService,GeometryService,$modal){var vm=this;vm.selectedResult=null,vm.prevResult=null,vm.nextResult=null,vm.props=[],$scope.$watch(function(){return ResultsData.SelectedFeature},function(newVal,oldVal){if(oldVal&&oldVal!=newVal&&oldVal.mapItem){var tmplayer=oldVal.mapItem._layers[Object.keys(oldVal.mapItem._layers)[0]];if(tmplayer._latlngs)tmplayer.setStyle(Style.DEFAULT);else{var myicon=L.icon({iconUrl:"bower_components/leaflet/dist/images/marker-icon.png",iconRetinaUrl:"bower_components/leaflet/dist/images/marker-icon-2x.png",shadowUrl:"bower_components/leaflet/dist/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]});tmplayer.setIcon(myicon)}}if(newVal){if(newVal.mapItem){var tmplayer=newVal.mapItem._layers[Object.keys(newVal.mapItem._layers)[0]];if(tmplayer._latlngs)tmplayer.setStyle(Style.HIGHLIGHT);else{var myIcon=L.AwesomeMarkers.icon({icon:"fa-dot-circle-o",markerColor:"red"});tmplayer.setIcon(myIcon)}}vm.selectedResult=newVal;var item=Object.getOwnPropertyNames(newVal.properties).map(function(k){return{key:k,value:newVal.properties[k]}});vm.props=item,vm.prevResult=SearchService.GetPrevResult(),vm.nextResult=SearchService.GetNextResult()}else vm.selectedResult=null,vm.prevResult=null,vm.nextResult=null}),vm.toonFeatureOpKaart=function(){"esri"===vm.selectedResult.theme.Type?MapData.PanToFeature(vm.selectedResult.mapItem):MapData.GoToLastClickBounds()},vm.volgende=function(){ResultsData.SelectedFeature=vm.nextResult},vm.vorige=function(){ResultsData.SelectedFeature=vm.prevResult},vm.buffer=1,vm.doordruk=function(){console.log(ResultsData.SelectedFeature),ResultsData.SelectedFeature.mapItem.toGeoJSON().features.forEach(function(feature){GeometryService.Doordruk(feature)})},vm.buffer=function(){var bufferInstance=$modal.open({templateUrl:"templates/search/bufferTemplate.html",controller:"BufferController",resolve:{backdrop:!1,keyboard:!0}});bufferInstance.result.then(function(returnobj){ResultsData.SelectedFeature.mapItem.toGeoJSON().features.forEach(function(feature){GeometryService.Buffer(feature,returnobj.buffer,returnobj.layer)})},function(obj){console.log("Modal dismissed at: "+new Date)})},vm.delete=function(){var prev=SearchService.GetPrevResult(),next=SearchService.GetNextResult();SearchService.DeleteFeature(vm.selectedResult),next?ResultsData.SelectedFeature=next:prev?ResultsData.SelectedFeature=prev:ResultsData.SelectedFeature=null},vm.close=function(feature){vm.selectedResult=null,vm.prevResult=null,vm.nextResult=null,ResultsData.SelectedFeature=null}});theController.$inject=["$scope","ResultsData","GeometryService","$modal"]}(),function(module){module=angular.module("tink.gis"),module.directive("tinkSearch",function(){return{replace:!0,templateUrl:"templates/search/searchTemplate.html",controller:"searchController",controllerAs:"srchctrl"}})}(),function(module){module=angular.module("tink.gis"),module.directive("tinkSearchResults",function(){return{replace:!0,templateUrl:"templates/search/searchResultsTemplate.html",controller:"searchResultsController",controllerAs:"srchrsltsctrl"}})}(),function(module){module=angular.module("tink.gis"),module.directive("tinkSearchSelected",function(){return{replace:!0,templateUrl:"templates/search/searchSelectedTemplate.html",controller:"searchSelectedController",controllerAs:"srchslctdctrl"}})}(),function(){var module=angular.module("tink.gis"),data=function(){var _data={};return _data.SelectedFeature=null,_data.JsonFeatures=[],_data.RequestCompleted=0,_data.RequestStarted=0,_data.GetRequestPercentage=function(){var percentage=Math.round(_data.RequestCompleted/_data.RequestStarted*100);return isNaN(percentage)?100:percentage},_data.EmptyResult=!1,_data.CleanSearch=function(){_data.SelectedFeature=null,_data.JsonFeatures.length=0,_data.RequestStarted=_data.RequestStarted-_data.RequestCompleted,_data.RequestCompleted=0},_data};module.factory("ResultsData",data)}(),function(){var module=angular.module("tink.gis"),service=function(ResultsData,map){var _service={};return _service.DeleteFeature=function(feature){var featureIndex=ResultsData.JsonFeatures.indexOf(feature);featureIndex>-1&&(feature.mapItem&&map.removeLayer(feature.mapItem),ResultsData.JsonFeatures.splice(featureIndex,1))},_service.DeleteFeatureGroup=function(featureGroupName){var toDelFeatures=[];ResultsData.JsonFeatures.forEach(function(feature){feature.layerName===featureGroupName&&toDelFeatures.push(feature)}),toDelFeatures.forEach(function(feat){_service.DeleteFeature(feat)})},_service.ExportToCSV=function(){var csvContent="",dataString="",layName="";csvContent+="Laag;\n",_.sortBy(ResultsData.JsonFeatures,function(x){return x.layerName}).forEach(function(feature,index){if(layName!==feature.layerName){layName=feature.layerName;var tmparr=[];for(var name in feature.properties)tmparr.push(name);var layfirstline=tmparr.join(";");csvContent+=layName+";"+layfirstline+"\n"}var infoArray=_.values(feature.properties);infoArray.unshift(layName),dataString=infoArray.join(";"),console.log(dataString),csvContent+=index<ResultsData.JsonFeatures.length?dataString+"\n":dataString});var a=document.createElement("a");a.href="data:attachment/csv,"+encodeURIComponent(csvContent),a.target="_blank",a.download="exportsik.csv",document.body.appendChild(a),a.click()},_service.GetNextResult=function(){var index=ResultsData.JsonFeatures.indexOf(ResultsData.SelectedFeature),layerName=ResultsData.SelectedFeature.layerName;if(index<ResultsData.JsonFeatures.length-1){var nextItem=ResultsData.JsonFeatures[index+1];if(nextItem.layerName===layerName)return nextItem}return null},_service.GetPrevResult=function(){var index=ResultsData.JsonFeatures.indexOf(ResultsData.SelectedFeature),layerName=ResultsData.SelectedFeature.layerName;if(index>0){var prevItem=ResultsData.JsonFeatures[index-1];if(prevItem.layerName===layerName)return prevItem}return null},_service};module.factory("SearchService",service)}(),L.TileLayer.BetterWMS=L.TileLayer.WMS.extend({getFeatureInfo:function(latlng,layers){var HelperService=angular.element(document.body).injector().get("HelperService"),url=this.getFeatureInfoUrl(latlng,layers),prom=$.ajax({url:HelperService.CreateProxyUrl(url),success:function(data,status,xhr){},error:function(xhr,status,_error){}});return prom},getFeatureInfoUrl:function(latlng,layers){var point=this._map.latLngToContainerPoint(latlng,this._map.getZoom()),size=this._map.getSize(),params={request:"GetFeatureInfo",service:"WMS",srs:"EPSG:4326",styles:this.wmsParams.styles,transparent:this.wmsParams.transparent,version:this.wmsParams.version,format:this.wmsParams.format,bbox:this._map.getBounds().toBBoxString(),height:size.y,width:size.x,layers:layers,query_layers:layers,buffer:100,info_format:"text/xml"};return params["1.3.0"===params.version?"i":"x"]=point.x,params["1.3.0"===params.version?"j":"y"]=point.y,this._url+L.Util.getParamString(params,this._url,!0)}}),L.tileLayer.betterWms=function(url,options){return new L.TileLayer.BetterWMS(url,options)},L.drawVersion="0.3.0-dev",L.drawLocal={draw:{toolbar:{actions:{title:"Tekenen annuleren",text:"Annuleren"},finish:{title:"Tekenen beindigen",text:"Tekenen beindigen"},undo:{title:"Verwijder laatst getekende punt",text:"Verwijder laatste punt"},buttons:{polyline:"Teken een lijn",polygon:"Teken een veelhoek",rectangle:"Teken een rechthoek",circle:"Teken een cirkel",marker:"Teken een markering"}},handlers:{circle:{tooltip:{start:"Klik en sleep om een cirkel te tekenen."},radius:"Straal"},marker:{tooltip:{start:"Klik om een markering te plaatsen."}},polygon:{tooltip:{start:"Klik om een veelhoek  te tekenen.",cont:"Klik om de veelhoek verder te tekenen.",end:"Klik op het eerste punt om de veelhoek te sluiten."}},polyline:{error:"<strong>Error:</strong> figuur randen mogen niet kruisen!",tooltip:{start:"Klik om een lijn te tekenen.",cont:"Klik om de lijn verder te tekenen.",end:"Klik op het laatste punt om de lijn af te sluiten."}},rectangle:{tooltip:{start:"Klik en sleep om een rechthoek te tekenen."}},simpleshape:{tooltip:{end:"Laat de muis los om het tekenen te beindigen."}}}},edit:{toolbar:{actions:{save:{title:"Aanpassingen bewaren.",text:"Bewaren"},cancel:{title:"Tekenen annuleren, aanpassingen verwijderen.",text:"Annuleren"}},buttons:{edit:"Lagen bewerken.",editDisabled:"Geen lagen om te bewerken.",remove:"Lagen verwijderen.",removeDisabled:"Geen lagen om te verwijderen."}},handlers:{edit:{tooltip:{text:"Versleep ankerpunt of markering om het object aan te passen.",subtext:"Klink Annuleer om de aanpassingen ongedaan te maken."}},remove:{tooltip:{text:"Klik op object om te verwijderen"}}}}},function(module){module=angular.module("tink.gis"),module.factory("RecursionHelper",["$compile",function($compile){return{compile:function(element,link){angular.isFunction(link)&&(link={post:link});var compiledContents,contents=element.contents().remove();return{pre:link&&link.pre?link.pre:null,post:function(scope,element){compiledContents||(compiledContents=$compile(contents)),compiledContents(scope,function(clone){element.append(clone)}),link&&link.post&&link.post.apply(null,arguments)}}}}}])}(),angular.module("tink.gis").run(["$templateCache",function($templateCache){$templateCache.put("templates/external/streetView.html","<html>\n<head>\n<meta charset=utf-8>\n<title>Street View side-by-side</title>\n<style>\nhtml, body {\r\n        height: 100%;\r\n        margin: 0;\r\n        padding: 0;\r\n      }\r\n      #map,  {\r\n        float: left;\r\n        height: 0%;\r\n        width: 0%;\r\n      }\r\n       #pano {\r\n        float: left;\r\n        height: 100%;\r\n        width: 100%;\r\n      }\n</style>\n</head>\n<body>\n<div id=map></div>\n<div id=pano></div>\n<script>\nfunction initialize() {\r\n        \r\n        var urlLat = parseFloat((location.search.split('lat=')[1]||'').split('&')[0]);\r\n        var urlLng = parseFloat((location.search.split('lng=')[1]||'').split('&')[0]);\r\n        var fenway = {lat:urlLat, lng: urlLng};\r\n        var map = new google.maps.Map(document.getElementById('map'), {\r\n          center: fenway,\r\n          zoom: 14\r\n        });\r\n        var panorama = new google.maps.StreetViewPanorama(\r\n            document.getElementById('pano'), {\r\n              position: fenway,\r\n              pov: {\r\n                heading: 34,\r\n                pitch: 10\r\n              }\r\n            });\r\n        map.setStreetView(panorama);\r\n      }\n</script>\n<script async defer src=\"https://maps.googleapis.com/maps/api/js?callback=initialize\">\n</script>\n</body>\n</html>"),$templateCache.put("templates/layermanagement/geoPuntTemplate.html",'<div class="row relative-container">\n<div class="col-md-4 flex-column margin-top margin-bottom">\n<div>\n<input class=searchbox ng-model=searchTerm ng-change=searchChanged() ng-model-options="{debounce: 500}" placeholder="Geef een trefwoord of een url in">\n</div>\n<div class=margin-top>\n<input disabled value=https://geodata.antwerpen.be/arcgissql/services/P_SiK/Groeninventaris/MapServer/WMSServer>\n</div>\n<div class="scrollable-list margin-top margin-bottom" ng-if=!searchIsUrl ng-repeat="theme in availableThemes">\n<div ng-click=geopuntThemeChanged(theme) ng-class="{\'greytext\': theme.Type != \'wms\' &&  theme.Type != \'esri\'}">\n{{theme.Naam}}\n<i ng-if="theme.Added == true" class="fa fa-check-circle"></i>\n<i ng-if="theme.Added == null" class="fa fa-check-circle-o"></i>\n</div>\n</div>\n<div>\n<tink-pagination ng-hide="numberofrecordsmatched <= 5" tink-items-per-page-values=[5] tink-current-page=currentPage tink-change=pageChanged(page,perPage,next) tink-total-items=numberofrecordsmatched tink-items-per-page=recordsAPage></tink-pagination>\n</div>\n</div>\n<div class="col-md-8 flex-column margin-top margin-bottom">\n<div ng-if=searchIsUrl>\n<button ng-click=laadUrl()>Laad url</button>\n</div>\n<preview-layer class=margin-top ng-if=copySelectedTheme addorupdatefunc=AddOrUpdateTheme() theme=copySelectedTheme>\n</preview-layer>\n</div>\n</div>\n'),$templateCache.put("templates/layermanagement/layerManagerTemplate.html","<div>\n<div class=modal-header>\n<button type=button style=float:right data-ng-click=cancel()><i class=\"fa fa-times\"></i></button>\n<h4 class=model-title>Lagenbeheer\n</h4></div>\n<div class=modal-body>\n<div class=row>\n<div class=col-xs-12>\n<ul class=nav-tabs>\n<li role=presentation ng-class=\"{'active': active=='solr'}\"><a href=\"\" ng-click=\"active='solr'\">Stad</a></li>\n<li role=presentation ng-class=\"{'active': active=='geopunt'}\"><a href=# ng-click=\"active='geopunt'\">GeoPunt</a></li>\n<li role=presentation ng-class=\"{'active': active=='beheer'}\"><a href=\"\" ng-click=\"active='beheer'\">Beheer</a></li>\n</ul>\n</div>\n</div>\n<solr-gis ng-show=\"active=='solr'\"></solr-gis>\n<geo-punt ng-show=\"active=='geopunt'\"></geo-punt>\n<layers-management ng-if=\"active=='beheer'\"></layers-management>\n</div>\n<div class=modal-footer>\n</div>\n</div>\n"),$templateCache.put("templates/layermanagement/layersManagementTemplate.html",'<div class="row relative-container">\n<div class="col-md-4 flex-column margin-top margin-bottom">\n<div>\n<input class=searchbox ng-model=searchTerm ng-change=searchChanged() placeholder="Geef een trefwoord">\n</div>\n<div class="scrollable-list margin-top margin-bottom">\n<div ng-repeat="theme in availableThemes | filter:{name: searchTerm}">\n<dl ng-class="{active: isActive(theme)}">\n<a href=# class=theme-layer ng-click=ThemeChanged(theme)>\n<dt>{{theme.name}}</dt>\n</a>\n</dl>\n</div>\n</div>\n</div>\n<div class="col-md-8 flex-column margin-top margin-bottom">\n<preview-layer ng-if=copySelectedTheme theme=copySelectedTheme addorupdatefunc=AddOrUpdateTheme()>\n</preview-layer>\n</div>\n</div>\n'),$templateCache.put("templates/layermanagement/managementLayerTemplate.html",'<div ng-if=lyrctrl.layer.hasLayers>\n<div class=layercontroller-checkbox>\n<div class=can-open ng-class="{\'open\': showLayer}">\n<input indeterminate-checkbox child-list=lyrctrl.layer.AllLayers property=enabled type=checkbox ng-model=lyrctrl.layer.enabled id={{lyrctrl.layer.name}}{{lyrctrl.layer.id}}>\n<label for={{lyrctrl.layer.name}}{{lyrctrl.layer.id}}> {{lyrctrl.layer.title | limitTo: 99}}</label>\n<span ng-click="showLayer = !showLayer"></span>\n</div>\n<div ng-show=showLayer ng-repeat="lay in lyrctrl.layer.Layers">\n<tink-managementlayer layer=lay>\n</tink-managementlayer>\n</div>\n</div>\n</div>\n<div ng-if=!lyrctrl.layer.hasLayers>\n<div class=layercontroller-checkbox>\n<input type=checkbox ng-model="lyrctrl.layer.enabled " id={{lyrctrl.layer.name}}{{lyrctrl.layer.id}}>\n<label for="{{lyrctrl.layer.name}}{{lyrctrl.layer.id}} "> {{lyrctrl.layer.title | limitTo: 99}}</label>\n</div>\n</div>\n'),$templateCache.put("templates/layermanagement/previewLayerTemplate.html",'<div class=flex-column>\n<div ng-show="theme !== null">\n<button class=btn-primary ng-if="theme.Added == false" ng-click=addorupdatefunc()>Toevoegen</button>\n<button ng-if="theme.Added != false" ng-click=addorupdatefunc()>Update</button>\n<button ng-if="theme.Added != false" ng-click=delTheme()>Delete</button>\n</div>\n<div class=margin-top>\n<p>{{theme.Description}}</p>\n<p><small><a ng-href={{theme.CleanUrl}} target=_blank>Details</a></small></p>\n</div>\n<div class="layercontroller-checkbox scrollable-list">\n<input indeterminate-checkbox child-list=theme.AllLayers property=enabled type=checkbox ng-model=theme.enabled id={{theme.name}}>\n<label for={{theme.name}}>{{theme.name}}</label>\n<div ng-repeat="mainlayer in theme.Layers">\n<tink-managementlayer layer=mainlayer></tink-managementlayer>\n</div>\n</div>\n</div>\n'),$templateCache.put("templates/layermanagement/solrGISTemplate.html",'<div class="row relative-container">\n<div class="col-md-4 flex-column margin-top margin-bottom">\n<div>\n<input class=searchbox ng-model=searchTerm ng-change=searchChanged() ng-model-options="{debounce: 250}" placeholder="Geef een trefwoord">\n</div>\n<div class="scrollable-list margin-top margin-bottom">\n<div ng-repeat="theme in availableThemes">\n<dl ng-class="{active: isActive(theme)}">\n<a href=# class=theme-layer ng-click=solrThemeChanged(theme)>\n<dt>{{theme.name}}</dt>\n</a>\n<dd ng-repeat="layer in theme.layers">\n<span>{{layer.naam}}\n<span ng-show="layer.featuresCount > 0"> ({{layer.featuresCount}})</span>\n</span>\n<div class=featureinsolr>\n{{layer.features.join(\', \')}}\n</div>\n</dd>\n</dl>\n</div>\n</div>\n<div>\n<tink-pagination ng-hide="numberofrecordsmatched <= 5" tink-current-page=currentPage tink-change=pageChanged(page,perPage,next) tink-total-items=numberofrecordsmatched tink-items-per-page=recordsAPage></tink-pagination>\n</div>\n</div>\n<div class="col-md-8 flex-column margin-top margin-bottom">\n<preview-layer ng-if=copySelectedTheme theme=copySelectedTheme addorupdatefunc=AddOrUpdateTheme()>\n</preview-layer>\n</div>\n</div>\n'),
$templateCache.put("templates/other/layerTemplate.html",'<div ng-class="{\'hidden-print\': lyrctrl.layer.IsEnabledAndVisible == false}">\n<div ng-if=lyrctrl.layer.hasLayers>\n<li class="li-item toc-item-without-icon can-open" ng-class="{\'open\': showLayer}">\n<div>\n<input class="visible-box hidden-print" type=checkbox id={{lyrctrl.layer.name}}{{lyrctrl.layer.id}} ng-model=lyrctrl.layer.visible ng-change=layercheckboxchange(lyrctrl.layer.theme)>\n<label for={{lyrctrl.layer.name}}{{lyrctrl.layer.id}}>{{lyrctrl.layer.name}}</label>\n</div>\n<div>\n<span ng-click="showLayer = !showLayer"></span>\n</div>\n</li>\n<ul ng-show=showLayer ng-repeat="layer in lyrctrl.layer.Layers | filter :  { enabled: true }">\n<tink-layer layer=layer layercheckboxchange=layercheckboxchange(layer.theme)>\n</tink-layer>\n</ul>\n</div>\n<li class="li-item toc-item-with-icon" ng-if=!lyrctrl.layer.hasLayers>\n<img class=layer-icon ng-if="lyrctrl.layer.theme.Type==\'esri\' && lyrctrl.layer.legend.length==1" ng-src="{{lyrctrl.layer.legend[0].fullurl}} ">\n<div>\n<input class="visible-box hidden-print" type=checkbox ng-model=lyrctrl.layer.visible ng-change=layercheckboxchange(lyrctrl.layer.theme) id="{{lyrctrl.layer.name}}{{lyrctrl.layer.id}} ">\n<label ng-class="{ \'greytext\': lyrctrl.layer.displayed==false} " for={{lyrctrl.layer.name}}{{lyrctrl.layer.id}}> {{lyrctrl.layer.title}}\n<span class=hidden-print ng-show="lyrctrl.layer.theme.Type==\'wms\' && lyrctrl.layer.queryable ">(i)</span>\n</label>\n</div>\n</li>\n<li class=li-item ng-if="lyrctrl.layer.theme.Type==\'wms\'">\n<img ng-src={{lyrctrl.layer.legendUrl}}><img>\n<div ng-if="lyrctrl.layer.theme.Type==\'esri\' && lyrctrl.layer.legend.length> 1" ng-repeat="legend in lyrctrl.legends">\n<img style="width:20px; height:20px" ng-src={{legend.url}}><img><span>{{legend.label}}</span>\n</div>\n</li>\n</div>\n'),$templateCache.put("templates/other/layersTemplate.html",'<div data-tink-nav-aside="" id=rightaside data-auto-select=true data-toggle-id=asideNavRight class="nav-aside nav-right">\n<aside>\n<div class=nav-aside-section>\n<p class=nav-aside-title>Lagenoverzicht</p>\n</div>\n<button class=nav-right-toggle data-tink-sidenav-collapse=asideNavRight>\n<a href=# title="Open menu"><span class=sr-only>Open right menu</span></a>\n</button>\n<div>\n<button class="btn btn-primary addlayerbtn" ng-click=lyrsctrl.Lagenbeheer()>Lagenbeheer</button>\n</div>\n<div class=nav-aside-padding>\n<ul class=ul-level id=sortableThemes ui-sortable=lyrsctrl.sortableOptions ng-model=lyrsctrl.themes>\n<li class=li-item ng-repeat="theme in lyrsctrl.themes">\n<tink-theme theme=theme layercheckboxchange=lyrsctrl.updatethemevisibility(theme) hidedelete=false>\n</tink-theme>\n</li>\n</ul>\n</div>\n</aside>\n</div>\n'),$templateCache.put("templates/other/mapTemplate.html",'<div class=tink-map>\n<div class=printpart>\n<div class=row>\n<h4 class=col-xs-6>Stad in kaart</h4>\n<div class=col-xs-6>\n<div class="btn-group pull-right">\n<button type=button class="btn hidden-print" ng-click=mapctrl.print()>Print</button>\n<button type=button class="btn hidden-print" ng-click=mapctrl.cancelPrint()>Annuleer</button>\n</div>\n<div class="btn-group pull-right" style="margin-right: 5px">\n<button type=button class="btn hidden-print" ng-class="{active: mapctrl.printStyle==\'portrait\'}" ng-click=mapctrl.portrait()>Staand</button>\n<button type=button class="btn hidden-print" ng-class="{active: mapctrl.printStyle==\'landscape\'}" ng-click=mapctrl.landscape()>Liggend</button>\n</div>\n</div>\n</div>\n</div>\n<div class=mappart>\n<tink-search class=tink-search></tink-search>\n<div id=map class="leafletmap leaflet-crosshair">\n<div class=map-buttons-left>\n<div class="btn-group ll drawingbtns" ng-show=mapctrl.showDrawControls>\n<button ng-click=mapctrl.selectpunt() ng-class="{active: mapctrl.drawingType==\'\'}" type=button class=btn prevent-default><i class="fa fa-mouse-pointer"></i></button>\n<button ng-click="mapctrl.drawingButtonChanged(\'lijn\')" ng-class="{active: mapctrl.drawingType==\'lijn\'}" type=button class=btn prevent-default><i class="fa fa-minus"></i></button>\n<button ng-click="mapctrl.drawingButtonChanged(\'vierkant\')" ng-class="{active: mapctrl.drawingType==\'vierkant\'}" type=button class=btn prevent-default><i class="fa fa-square-o"></i></button>\n<button ng-click="mapctrl.drawingButtonChanged(\'polygon\')" ng-class="{active: mapctrl.drawingType==\'polygon\'}" type=button class=btn prevent-default><i class="fa fa-star-o"></i></button>\n</div>\n<div class="btn-group btn-group-vertical ll interactiebtns">\n<button type=button class=btn ng-click="mapctrl.interactieButtonChanged(\'identify\')" ng-class="{active: mapctrl.activeInteractieKnop==\'identify\'}" prevent-default><i class="fa fa-info"></i></button>\n<button type=button class=btn ng-click="mapctrl.interactieButtonChanged(\'select\')" ng-class="{active: mapctrl.activeInteractieKnop==\'select\'}" prevent-default><i class="fa fa-mouse-pointer"></i></button>\n<button type=button class=btn ng-click="mapctrl.interactieButtonChanged(\'meten\')" ng-class="{active: mapctrl.activeInteractieKnop==\'meten\'}" prevent-default><i class="fa fa-expand"></i></button>\n<button type=button class=btn ng-click="mapctrl.interactieButtonChanged(\'watishier\')" ng-class="{active: mapctrl.activeInteractieKnop==\'watishier\'}" prevent-default><i class="fa fa-thumb-tack"></i></button>\n</div>\n<div class="btn-group ll kaarttypes">\n<button class=btn ng-class="{active: mapctrl.IsBaseMap1==true}" ng-click=mapctrl.toonBaseMap1() prevent-default>{{mapctrl.baseMap1Naam()}}</button>\n<button class=btn ng-class="{active: mapctrl.IsBaseMap1==false}" ng-click=mapctrl.toonBaseMap2() prevent-default>{{mapctrl.baseMap2Naam()}}</button>\n</div>\n<div class="btn-group ll metenbtns" ng-show=mapctrl.showMetenControls>\n<button ng-click="mapctrl.drawingButtonChanged(\'afstand\')" ng-class="{active: mapctrl.drawingType==\'afstand\'}" type=button class=btn prevent-default><i class="fa fa-arrows-h"></i></button>\n<button ng-click="mapctrl.drawingButtonChanged(\'oppervlakte\')" ng-class="{active: mapctrl.drawingType==\'oppervlakte\'}" type=button class=btn prevent-default><i class="fa fa-star-o"></i></button>\n</div>\n<div class="btn-group ll searchbtns">\n<button type=button class=btn ng-class="{active: mapctrl.ZoekenOpLocatie==true}" ng-click=mapctrl.fnZoekenOpLocatie() prevent-default><i class="fa fa-map-marker"></i></button>\n<button type=button class=btn ng-class="{active: mapctrl.ZoekenOpLocatie==false}" ng-click=mapctrl.ZoekenInLagen() prevent-default><i class="fa fa-download"></i></button>\n</div>\n<div id=zoekbalken class="ll zoekbalken">\n<input type=search class=zoekbalk ng-show="mapctrl.ZoekenOpLocatie == false" placeholder="Geef een zoekterm" prevent-default ng-keyup="$event.keyCode == 13 && mapctrl.zoekLaag(mapctrl.laagquery)" ng-model=mapctrl.laagquery>\n<select ng-options="layer as layer.name for layer in mapctrl.SelectableLayers()" ng-model=mapctrl.selectedLayer ng-show="mapctrl.activeInteractieKnop==\'select\' && mapctrl.SelectableLayers().length > 1" ng-change=mapctrl.layerChange() prevent-default></select>\n</div>\n</div>\n<div class=map-buttons-right>\n<div class="btn-group btn-group-vertical ll viewbtns">\n<button type=button class=btn ng-click=mapctrl.zoomIn() prevent-default><i class="fa fa-plus"></i></button>\n<button type=button class=btn ng-click=mapctrl.zoomOut() prevent-default><i class="fa fa-minus"></i></button>\n<button type=button class=btn ng-click=mapctrl.zoomToGps() ng-class="{active: mapctrl.gpstracking==true}" prevent-default><i class="fa fa-crosshairs"></i></button>\n</div>\n<div class="ll loading" ng-show="mapctrl.Loading > 0">\n<div class=loader></div> {{mapctrl.MaxLoading - mapctrl.Loading}}/ {{mapctrl.MaxLoading}}\n</div>\n</div>\n</div>\n<tink-layers class=tink-layers></tink-layers>\n</div>\n<div class=printpart>\n<div class=row>\n<div class=col-xs-2>\n<img class="float-left print-corner-image" src=https://www.antwerpen.be/assets/aOS/gfx/gui/a-logo.svg alt="Antwerpen logo">\n</div>\n<div class=col-xs-8>Voorbehoud: De kaart is een reproductie zonder juridische waarde. Zij bevat kaartmateriaal en info afkomstig van het stadsbestuur Antwerpen, AGIV, AAPD, Provinciebesturen en mogelijk nog andere organisaties.\n</div>\n<div class=col-xs-2>\n<img class="float-right print-corner-image" src=http://images.vectorhq.com/images/previews/111/north-arrow-orienteering-137692.png alt="Noord pijl orintatielopen">\n</div>\n</div>\n</div>\n</div>'),$templateCache.put("templates/other/themeTemplate.html",'<div>\n<input class="visible-box hidden-print" type=checkbox id=chk{{thmctrl.theme.Naam}} ng-model=thmctrl.theme.Visible ng-change=layercheckboxchange(thmctrl.theme)>\n<label for=chk{{thmctrl.theme.Naam}}> {{thmctrl.theme.Naam}} <span class=hidden-print ng-show="thmctrl.theme.Type==\'esri\'">(stad)</span><span class=hidden-print ng-hide="thmctrl.theme.Type==\'esri\'">({{thmctrl.theme.Type}})</span></label>\n<button ng-hide="hidedelete == true" class="trash pull-right" ng-click=thmctrl.deleteTheme()></button>\n<ul class="ul-level layercontroller-checkbox" ng-repeat="layer in thmctrl.theme.Layers | filter: { enabled: true }">\n<tink-layer layer=layer layercheckboxchange=layercheckboxchange(layer.theme)>\n</tink-layer>\n</ul>\n</div>\n'),$templateCache.put("templates/search/bufferTemplate.html",'<div>\n<div class=modal-header>\n<button type=button style=float:right data-ng-click=cancel()><i class="fa fa-times"></i></button>\n<h4 class=model-title>Buffer instellen</h4>\n</div>\n<div class=modal-content>\nSelecteer de laag:\n<select ng-options="layer as layer.name for layer in SelectableLayers" ng-model=selectedLayer prevent-default></select> Geef de bufferafstand:\n<input type=number ng-model=buffer>\n</div>\n<div class=modal-footer>\n<button data-ng-click=ok()>Klaar</button>\n</div>\n</div>'),$templateCache.put("templates/search/searchResultsTemplate.html",'<div ng-if="!srchrsltsctrl.selectedResult && srchrsltsctrl.featureLayers.length > 0">\n<select ng-model=srchrsltsctrl.layerGroupFilter>\n<option value=geenfilter selected>Geen filter ({{srchrsltsctrl.features.length}})</option>\n<option ng-repeat="feat in srchrsltsctrl.featureLayers" value={{feat}}>{{feat}} ({{srchrsltsctrl.aantalFeaturesMetType(feat)}})</option>\n</select>\n<ul ng-repeat="layerGroupName in srchrsltsctrl.featureLayers">\n<tink-accordion ng-if="srchrsltsctrl.layerGroupFilter==\'geenfilter\' || srchrsltsctrl.layerGroupFilter==layerGroupName " data-start-open=true data-one-at-a-time=false>\n<tink-accordion-panel>\n<data-header>\n<p class=nav-aside-title>{{layerGroupName}} ({{srchrsltsctrl.aantalFeaturesMetType(layerGroupName)}})\n<button prevent-default ng-click=srchrsltsctrl.deleteFeatureGroup(layerGroupName) class="trash pull-right"></button>\n</p>\n</data-header>\n<data-content>\n<li ng-repeat="feature in srchrsltsctrl.features | filter: { layerName:layerGroupName } :true" ng-mouseover=srchrsltsctrl.HoverOver(feature)>\n<div class=mouse-over>\n<a tink-tooltip={{feature.displayValue}} tink-tooltip-align=bottom ng-click=srchrsltsctrl.showDetails(feature)>{{ feature.displayValue| limitTo : 23 }}\n</a>\n<button class="trash pull-right mouse-over-toshow" prevent-default ng-click=srchrsltsctrl.deleteFeature(feature)></button>\n</div>\n</li>\n</data-content>\n</tink-accordion-panel>\n</tink-accordion>\n</ul>\n<button class="btn-sm margin-left margin-top" ng-click=srchrsltsctrl.exportToCSV()>Exporteer naar CSV</button>\n</div>'),$templateCache.put("templates/search/searchSelectedTemplate.html",'<div ng-if=srchslctdctrl.selectedResult class=nav-aside-padding>\n<div class="row margin-top margin-bottom">\n<div class=col-xs-12>\n<div class=btn-group>\n<button type=button class=btn ng-disabled=!srchslctdctrl.prevResult ng-click=srchslctdctrl.vorige()>Vorige</button>\n<button type=button class=btn ng-disabled=!srchslctdctrl.nextResult ng-click=srchslctdctrl.volgende()>Volgende</button>\n</div>\n<button class="srchbtn btn pull-right" ng-click=srchslctdctrl.delete()>Verwijderen</button>\n</div>\n</div>\n<dl ng-repeat="prop in srchslctdctrl.props">\n<dt>{{ prop.key}}</dt>\n<div ng-if="prop.value.toLowerCase() != \'null\'">\n<a ng-if=" prop.value.indexOf( \'https://\')==0 || prop.value.indexOf( \'http://\')==0 " ng-href={{prop.value}} target=_blank>% Link</a>\n<dd ng-if="prop.value.indexOf( \'https://\') !=0 && prop.value.indexOf( \'http://\') !=0 ">{{ prop.value }}</dd>\n</div>\n</dl>\n<div class=row>\n<div class=col-xs-4>\n<div class=row>\n<div class=col-xs-12>\n<button class="btn-primary srchbtn" ng-click=srchslctdctrl.toonFeatureOpKaart()>Tonen</button>\n</div>\n</div>\n</div>\n<div class=col-xs-8>\n<div class=row>\n<div class=col-xs-6>\n<button class="srchbtn pull-right" ng-click=srchslctdctrl.doordruk()>Doordruk</button>\n</div>\n<div class=col-xs-6>\n<button class="srchbtn pull-right" ng-click=srchslctdctrl.buffer()>Buffer</button>\n</div>\n</div>\n</div>\n</div>\n<div class="row margin-top margin-bottom">\n<div class=col-xs-4>\n<div class=row>\n<div class=col-xs-12>\n</div>\n</div>\n</div>\n<div class=col-xs-8>\n<div class=row>\n<div class=col-xs-12>\n<a class="srchbtn pull-right" ng-click=srchslctdctrl.close(srchslctdctrl.selectedResult)>Terug naar resultaten</a>\n</div>\n</div>\n</div>\n</div>\n</div>\n'),$templateCache.put("templates/search/searchTemplate.html",'<div data-tink-nav-aside="" id=leftaside data-auto-select=true data-toggle-id=asideNavLeft class="nav-aside nav-left">\n<aside>\n<div class=nav-aside-section>\n<p class=nav-aside-title>Resultaten</p>\n</div>\n<button class=nav-left-toggle data-tink-sidenav-collapse=asideNavLeft>\n<a href=# title="Open menu"><span class=sr-only>Open left menu</span></a>\n</button>\n<div ng-show="srchctrl.LoadingCompleted() == true">\n<tink-search-results></tink-search-results>\n<tink-search-selected></tink-search-selected>\n</div>\n<div class="loader-advanced center-block margin-top margin-bottom" ng-show="srchctrl.LoadingCompleted() == false">\n<span class=loader></span>\n<span class=loader-percentage>{{srchctrl.loadingPercentage()}}%</span>\n</div>\n</aside>\n</div>\n')}]);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),TinkGis;!function(TinkGis){var LayerJSON=function LayerJSON(){_classCallCheck(this,LayerJSON)};TinkGis.LayerJSON=LayerJSON;var Layer=function(_LayerJSON){function Layer(){var _ref;_classCallCheck(this,Layer);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];var _this=_possibleConstructorReturn(this,(_ref=Layer.__proto__||Object.getPrototypeOf(Layer)).call.apply(_ref,[this].concat(args)));return _this.parent=null,_this.Layers=[],_this.UpdateDisplayed=function(currentScale){(_this.maxScale>0||_this.minScale>0)&&(console.log("MinMaxandCurrentScale",_this.maxScale,_this.minScale,currentScale),currentScale>_this.maxScale&&currentScale<_this.minScale?_this.displayed=!0:_this.displayed=!1)},_this.toString=function(){return"Lay: (id: "+_this.name+")"},_this}return _inherits(Layer,_LayerJSON),_createClass(Layer,[{key:"hasLayers",get:function(){return!!this.Layers&&this.Layers.length>0}},{key:"ShouldBeVisible",get:function(){return!(!this.IsEnabledAndVisible||this.hasLayers||this.parent&&!this.parent.IsEnabledAndVisible)}},{key:"IsEnabledAndVisible",get:function(){return!!(this.theme.enabled&&this.enabled&&this.visible)&&(!this.parent||this.parent.IsEnabledAndVisible)}},{key:"AllLayers",get:function(){var allLay=this.Layers;return this.Layers.forEach(function(lay){allLay=allLay.concat(lay.AllLayers)}),allLay}}]),Layer}(LayerJSON);TinkGis.Layer=Layer;var wmslayer=function(_Layer){function wmslayer(info,parenttheme){_classCallCheck(this,wmslayer);var _this2=_possibleConstructorReturn(this,(wmslayer.__proto__||Object.getPrototypeOf(wmslayer)).call(this));return Object.assign(_this2,info),_this2.visible=!0,_this2.enabled=!0,_this2.displayed=!0,_this2.theme=parenttheme,_this2.queryable=info.queryable,_this2.id=_this2.name,_this2}return _inherits(wmslayer,_Layer),_createClass(wmslayer,[{key:"legendUrl",get:function(){return this.theme.CleanUrl+"?REQUEST=GetLegendGraphic&VERSION=1.0.0&FORMAT=image/png&LAYER="+this.id}}]),wmslayer}(Layer);TinkGis.wmslayer=wmslayer;var argislegend=function argislegend(label,url){_classCallCheck(this,argislegend),this.label=label,this.url=url};TinkGis.argislegend=argislegend;var arcgislayer=function(_Layer2){function arcgislayer(info,parenttheme){_classCallCheck(this,arcgislayer);var _this3=_possibleConstructorReturn(this,(arcgislayer.__proto__||Object.getPrototypeOf(arcgislayer)).call(this));return Object.assign(_this3,info),_this3.visible=info.defaultVisibility,_this3.enabled=!0,_this3.title=info.name,_this3.theme=parenttheme,_this3.displayed=!0,_this3.queryable=!1,_this3}return _inherits(arcgislayer,_Layer2),_createClass(arcgislayer,[{key:"legends",get:function(){return this.legend.map(function(x){return new argislegend(x.label,x.fullurl)})}}]),arcgislayer}(Layer);TinkGis.arcgislayer=arcgislayer}(TinkGis||(TinkGis={}));var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),TinkGis;!function(TinkGis){var Theme=function(){function Theme(){var _this=this;_classCallCheck(this,Theme),this.Layers=[],this.UpdateDisplayed=function(currentScale){_this.AllLayers.forEach(function(layer){layer.UpdateDisplayed(currentScale)})}}return _createClass(Theme,[{key:"VisibleLayers",get:function(){if(this.Visible){var allLay=this.AllLayers.filter(function(x){return x.ShouldBeVisible});return allLay}return[]}},{key:"EnabledLayers",get:function(){if(this.Visible){var allLay=this.AllLayers.filter(function(x){return x.enabled});return allLay}return[]}},{key:"VisibleLayerIds",get:function(){return this.VisibleLayers.map(function(x){return x.id})}},{key:"AllLayers",get:function(){var allLay=this.Layers;return this.Layers.forEach(function(lay){allLay=allLay.concat(lay.AllLayers)}),allLay}}]),Theme}();TinkGis.Theme=Theme;var ArcGIStheme=function(_Theme){function ArcGIStheme(rawdata,themeData){_classCallCheck(this,ArcGIStheme);var _this2=_possibleConstructorReturn(this,(ArcGIStheme.__proto__||Object.getPrototypeOf(ArcGIStheme)).call(this)),rawlayers=rawdata.layers;_this2.name=_this2.Naam=rawdata.documentInfo.Title,_this2.Description=rawdata.documentInfo.Subject,_this2.CleanUrl=themeData.cleanUrl;var cleanurlSplitted=themeData.cleanUrl.split("/");_this2.Url=cleanurlSplitted[5]+"/"+cleanurlSplitted[6]+"/"+cleanurlSplitted[7]+"/"+cleanurlSplitted[8],_this2.Visible=!0,_this2.Added=!1,_this2.enabled=!0,_this2.Type=ThemeType.ESRI,_this2.status=ThemeStatus.UNMODIFIED,_this2.MapData={};var convertedLayers=rawlayers.map(function(x){return new TinkGis.arcgislayer(x,_this2)});return convertedLayers.forEach(function(argislay){if(argislay.parentLayerId===-1)_this2.Layers.push(argislay);else{var parentlayer=convertedLayers.find(function(x){return x.id==argislay.parentLayerId});argislay.parent=parentlayer,parentlayer.Layers.push(argislay)}}),_this2}return _inherits(ArcGIStheme,_Theme),_createClass(ArcGIStheme,[{key:"UpdateMap",value:function(){0!==this.VisibleLayerIds.length?this.MapData.setLayers(this.VisibleLayerIds):this.MapData.setLayers([-1])}}]),ArcGIStheme}(Theme);TinkGis.ArcGIStheme=ArcGIStheme;var wmstheme=function(_Theme2){function wmstheme(data,url){_classCallCheck(this,wmstheme);var _this3=_possibleConstructorReturn(this,(wmstheme.__proto__||Object.getPrototypeOf(wmstheme)).call(this));_this3.Version=data.version,_this3.name=_this3.Naam=data.service.title,_this3.enabled=!0,_this3.Visible=!0,_this3.CleanUrl=url,_this3.Added=!1,_this3.status=ThemeStatus.NEW,_this3.Description=data.service.abstract,_this3.Type=ThemeType.WMS;var layers=data.capability.layer.layer;layers.layer&&(layers=layers.layer);var lays=[];return layers?void 0==layers.length?lays.push(layers):lays=layers:lays.push(data.capability.layer),lays.forEach(function(layer){var lay=new TinkGis.wmslayer(layer,_this3);_this3.Layers.push(lay)}),_this3}return _inherits(wmstheme,_Theme2),_createClass(wmstheme,[{key:"UpdateMap",value:function(map){this.MapData.options.layers=this.MapData.wmsParams.layers=this.VisibleLayerIds.join(","),this.MapData.redraw()}}]),wmstheme}(Theme);TinkGis.wmstheme=wmstheme}(TinkGis||(TinkGis={}));var TinkGis;!function(TinkGis){!function(){var module=angular.module("tink.gis"),service=function(){var ThemeCreater={};return ThemeCreater.createARCGISThemeFromJson=function(rawdata,themeData){var theme=new TinkGis.ArcGIStheme(rawdata,themeData);return theme},ThemeCreater.createWMSThemeFromJSON=function(data,url){var wms=new TinkGis.wmstheme(data,url);return wms},ThemeCreater};module.factory("ThemeCreater",service)}()}(TinkGis||(TinkGis={}));
//# sourceMappingURL=tink-gis-angular.min.js.map